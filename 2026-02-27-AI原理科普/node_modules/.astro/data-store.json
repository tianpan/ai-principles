[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.18.0","content-config-digest","5fe3da86cd58b12a","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://ai-principles.dev\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"where\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":false,\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"css-variables\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[null,null,null],\"rehypePlugins\":[null,[null,{\"themes\":[{\"name\":\"Night Owl No Italics\",\"type\":\"dark\",\"colors\":{\"focusBorder\":\"#122d42\",\"foreground\":\"#d6deeb\",\"disabledForeground\":\"#cccccc80\",\"descriptionForeground\":\"#d6deebb3\",\"errorForeground\":\"#ef5350\",\"icon.foreground\":\"#c5c5c5\",\"contrastActiveBorder\":null,\"contrastBorder\":\"#122d42\",\"textBlockQuote.background\":\"#7f7f7f1a\",\"textBlockQuote.border\":\"#007acc80\",\"textCodeBlock.background\":\"#4f4f4f\",\"textLink.activeForeground\":\"#3794ff\",\"textLink.foreground\":\"#3794ff\",\"textPreformat.foreground\":\"#d7ba7d\",\"textSeparator.foreground\":\"#ffffff2e\",\"editor.background\":\"#23262f\",\"editor.foreground\":\"#d6deeb\",\"editorLineNumber.foreground\":\"#4b6479\",\"editorLineNumber.activeForeground\":\"#c5e4fd\",\"editorActiveLineNumber.foreground\":\"#c6c6c6\",\"editor.selectionBackground\":\"#1d3b53\",\"editor.inactiveSelectionBackground\":\"#7e57c25a\",\"editor.selectionHighlightBackground\":\"#5f7e9779\",\"editorError.foreground\":\"#ef5350\",\"editorWarning.foreground\":\"#b39554\",\"editorInfo.foreground\":\"#3794ff\",\"editorHint.foreground\":\"#eeeeeeb2\",\"problemsErrorIcon.foreground\":\"#ef5350\",\"problemsWarningIcon.foreground\":\"#b39554\",\"problemsInfoIcon.foreground\":\"#3794ff\",\"editor.findMatchBackground\":\"#5f7e9779\",\"editor.findMatchHighlightBackground\":\"#1085bb5d\",\"editor.findRangeHighlightBackground\":\"#3a3d4166\",\"editorLink.activeForeground\":\"#4e94ce\",\"editorLightBulb.foreground\":\"#ffcc00\",\"editorLightBulbAutoFix.foreground\":\"#75beff\",\"diffEditor.insertedTextBackground\":\"#99b76d23\",\"diffEditor.insertedTextBorder\":\"#c5e47833\",\"diffEditor.removedTextBackground\":\"#ef535033\",\"diffEditor.removedTextBorder\":\"#ef53504d\",\"diffEditor.insertedLineBackground\":\"#9bb95533\",\"diffEditor.removedLineBackground\":\"#ff000033\",\"editorStickyScroll.background\":\"#011627\",\"editorStickyScrollHover.background\":\"#2a2d2e\",\"editorInlayHint.background\":\"#5f7e97cc\",\"editorInlayHint.foreground\":\"#ffffff\",\"editorInlayHint.typeBackground\":\"#5f7e97cc\",\"editorInlayHint.typeForeground\":\"#ffffff\",\"editorInlayHint.parameterBackground\":\"#5f7e97cc\",\"editorInlayHint.parameterForeground\":\"#ffffff\",\"editorPane.background\":\"#011627\",\"editorGroup.emptyBackground\":\"#011627\",\"editorGroup.focusedEmptyBorder\":null,\"editorGroupHeader.tabsBackground\":\"var(--sl-color-black)\",\"editorGroupHeader.tabsBorder\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"editorGroupHeader.noTabsBackground\":\"#011627\",\"editorGroupHeader.border\":null,\"editorGroup.border\":\"#011627\",\"editorGroup.dropBackground\":\"#7e57c273\",\"editorGroup.dropIntoPromptForeground\":\"#d6deeb\",\"editorGroup.dropIntoPromptBackground\":\"#021320\",\"editorGroup.dropIntoPromptBorder\":null,\"sideBySideEditor.horizontalBorder\":\"#011627\",\"sideBySideEditor.verticalBorder\":\"#011627\",\"scrollbar.shadow\":\"#010b14\",\"scrollbarSlider.background\":\"#ffffff17\",\"scrollbarSlider.hoverBackground\":\"#ffffff40\",\"scrollbarSlider.activeBackground\":\"#084d8180\",\"panel.background\":\"#011627\",\"panel.border\":\"#5f7e97\",\"panelTitle.activeBorder\":\"#5f7e97\",\"panelTitle.activeForeground\":\"#ffffffcc\",\"panelTitle.inactiveForeground\":\"#d6deeb80\",\"panelSectionHeader.background\":\"#80808051\",\"terminal.background\":\"#011627\",\"widget.shadow\":\"#011627\",\"editorWidget.background\":\"#021320\",\"editorWidget.foreground\":\"#d6deeb\",\"editorWidget.border\":\"#5f7e97\",\"quickInput.background\":\"#021320\",\"quickInput.foreground\":\"#d6deeb\",\"quickInputTitle.background\":\"#ffffff1a\",\"pickerGroup.foreground\":\"#d1aaff\",\"pickerGroup.border\":\"#011627\",\"editor.hoverHighlightBackground\":\"#7e57c25a\",\"editorHoverWidget.background\":\"#011627\",\"editorHoverWidget.foreground\":\"#d6deeb\",\"editorHoverWidget.border\":\"#5f7e97\",\"editorHoverWidget.statusBarBackground\":\"#011a2f\",\"titleBar.activeBackground\":\"var(--sl-color-black)\",\"titleBar.activeForeground\":\"var(--sl-color-text)\",\"titleBar.inactiveBackground\":\"#010e1a\",\"titleBar.inactiveForeground\":\"#eeefff99\",\"titleBar.border\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"toolbar.hoverBackground\":\"#5a5d5e50\",\"toolbar.activeBackground\":\"#63666750\",\"tab.activeBackground\":\"#0b2942\",\"tab.unfocusedActiveBackground\":\"#0b2942\",\"tab.inactiveBackground\":\"#01111d\",\"tab.unfocusedInactiveBackground\":\"#01111d\",\"tab.activeForeground\":\"var(--sl-color-text)\",\"tab.inactiveForeground\":\"#5f7e97\",\"tab.unfocusedActiveForeground\":\"#5f7e97\",\"tab.unfocusedInactiveForeground\":\"#5f7e97\",\"tab.hoverBackground\":null,\"tab.unfocusedHoverBackground\":null,\"tab.hoverForeground\":null,\"tab.unfocusedHoverForeground\":null,\"tab.border\":\"#272b3b\",\"tab.lastPinnedBorder\":\"#585858\",\"tab.activeBorder\":\"transparent\",\"tab.unfocusedActiveBorder\":\"#262a39\",\"tab.activeBorderTop\":\"var(--sl-color-accent-high)\",\"tab.unfocusedActiveBorderTop\":null,\"tab.hoverBorder\":null,\"tab.unfocusedHoverBorder\":null,\"tab.activeModifiedBorder\":\"#3399cc\",\"tab.inactiveModifiedBorder\":\"#3399cc80\",\"tab.unfocusedActiveModifiedBorder\":\"#3399cc80\",\"tab.unfocusedInactiveModifiedBorder\":\"#3399cc40\",\"badge.background\":\"#5f7e97\",\"badge.foreground\":\"#ffffff\",\"button.background\":\"#7e57c2cc\",\"button.foreground\":\"#ffffffcc\",\"button.border\":\"#122d42\",\"button.separator\":\"#ffffff52\",\"button.hoverBackground\":\"#7e57c2\",\"button.secondaryBackground\":\"#3a3d41\",\"button.secondaryForeground\":\"#ffffff\",\"button.secondaryHoverBackground\":\"#46494e\",\"dropdown.background\":\"#011627\",\"dropdown.foreground\":\"#ffffffcc\",\"dropdown.border\":\"#5f7e97\",\"list.activeSelectionBackground\":\"#234d708c\",\"list.activeSelectionForeground\":\"#ffffff\",\"tree.indentGuidesStroke\":\"#585858\",\"input.background\":\"#0b253a\",\"input.foreground\":\"#ffffffcc\",\"input.placeholderForeground\":\"#5f7e97\",\"inputOption.activeBorder\":\"#ffffffcc\",\"inputOption.hoverBackground\":\"#5a5d5e80\",\"inputOption.activeBackground\":\"#122d4266\",\"inputOption.activeForeground\":\"#ffffff\",\"inputValidation.infoBackground\":\"#00589ef2\",\"inputValidation.infoBorder\":\"#64b5f6\",\"inputValidation.warningBackground\":\"#675700f2\",\"inputValidation.warningBorder\":\"#ffca28\",\"inputValidation.errorBackground\":\"#ab0300f2\",\"inputValidation.errorBorder\":\"#ef5350\",\"keybindingLabel.background\":\"#8080802b\",\"keybindingLabel.foreground\":\"#cccccc\",\"keybindingLabel.border\":\"#33333399\",\"keybindingLabel.bottomBorder\":\"#44444499\",\"menu.foreground\":\"#ffffffcc\",\"menu.background\":\"#011627\",\"menu.selectionForeground\":\"#ffffff\",\"menu.selectionBackground\":\"#234d708c\",\"menu.separatorBackground\":\"#606060\",\"editor.snippetTabstopHighlightBackground\":\"#7c7c74c\",\"editor.snippetFinalTabstopHighlightBorder\":\"#525252\",\"terminal.ansiBlack\":\"#011627\",\"terminal.ansiRed\":\"#ef5350\",\"terminal.ansiGreen\":\"#22da6e\",\"terminal.ansiYellow\":\"#c5e478\",\"terminal.ansiBlue\":\"#82aaff\",\"terminal.ansiMagenta\":\"#c792ea\",\"terminal.ansiCyan\":\"#21c7a8\",\"terminal.ansiWhite\":\"#ffffff\",\"terminal.ansiBrightBlack\":\"#575656\",\"terminal.ansiBrightRed\":\"#ef5350\",\"terminal.ansiBrightGreen\":\"#22da6e\",\"terminal.ansiBrightYellow\":\"#ffeb95\",\"terminal.ansiBrightBlue\":\"#82aaff\",\"terminal.ansiBrightMagenta\":\"#c792ea\",\"terminal.ansiBrightCyan\":\"#7fdbca\",\"terminal.ansiBrightWhite\":\"#ffffff\",\"selection.background\":\"#4373c2\",\"input.border\":\"#5f7e97\",\"punctuation.definition.generic.begin.html\":\"#ef5350f2\",\"progress.background\":\"#7e57c2\",\"breadcrumb.foreground\":\"#a599e9\",\"breadcrumb.focusForeground\":\"#ffffff\",\"breadcrumb.activeSelectionForeground\":\"#ffffff\",\"breadcrumbPicker.background\":\"#001122\",\"list.invalidItemForeground\":\"#975f94\",\"list.dropBackground\":\"#011627\",\"list.focusBackground\":\"#010d18\",\"list.focusForeground\":\"#ffffff\",\"list.highlightForeground\":\"#ffffff\",\"list.hoverBackground\":\"#011627\",\"list.hoverForeground\":\"#ffffff\",\"list.inactiveSelectionBackground\":\"#0e293f\",\"list.inactiveSelectionForeground\":\"#5f7e97\",\"activityBar.background\":\"#011627\",\"activityBar.dropBackground\":\"#5f7e97\",\"activityBar.foreground\":\"#5f7e97\",\"activityBar.border\":\"#011627\",\"activityBarBadge.background\":\"#44596b\",\"activityBarBadge.foreground\":\"#ffffff\",\"sideBar.background\":\"#011627\",\"sideBar.foreground\":\"#89a4bb\",\"sideBar.border\":\"#011627\",\"sideBarTitle.foreground\":\"#5f7e97\",\"sideBarSectionHeader.background\":\"#011627\",\"sideBarSectionHeader.foreground\":\"#5f7e97\",\"editorCursor.foreground\":\"#80a4c2\",\"editor.wordHighlightBackground\":\"#f6bbe533\",\"editor.wordHighlightStrongBackground\":\"#e2a2f433\",\"editor.lineHighlightBackground\":\"#0003\",\"editor.rangeHighlightBackground\":\"#7e57c25a\",\"editorIndentGuide.background\":\"#5e81ce52\",\"editorIndentGuide.activeBackground\":\"#7e97ac\",\"editorRuler.foreground\":\"#5e81ce52\",\"editorCodeLens.foreground\":\"#5e82ceb4\",\"editorBracketMatch.background\":\"#5f7e974d\",\"editorOverviewRuler.currentContentForeground\":\"#7e57c2\",\"editorOverviewRuler.incomingContentForeground\":\"#7e57c2\",\"editorOverviewRuler.commonContentForeground\":\"#7e57c2\",\"editorGutter.background\":\"#011627\",\"editorGutter.modifiedBackground\":\"#e2b93d\",\"editorGutter.addedBackground\":\"#9ccc65\",\"editorGutter.deletedBackground\":\"#ef5350\",\"editorSuggestWidget.background\":\"#2c3043\",\"editorSuggestWidget.border\":\"#2b2f40\",\"editorSuggestWidget.foreground\":\"#d6deeb\",\"editorSuggestWidget.highlightForeground\":\"#ffffff\",\"editorSuggestWidget.selectedBackground\":\"#5f7e97\",\"debugExceptionWidget.background\":\"#011627\",\"debugExceptionWidget.border\":\"#5f7e97\",\"editorMarkerNavigation.background\":\"#0b2942\",\"editorMarkerNavigationError.background\":\"#ef5350\",\"editorMarkerNavigationWarning.background\":\"#ffca28\",\"peekView.border\":\"#5f7e97\",\"peekViewEditor.background\":\"#011627\",\"peekViewEditor.matchHighlightBackground\":\"#7e57c25a\",\"peekViewResult.background\":\"#011627\",\"peekViewResult.fileForeground\":\"#5f7e97\",\"peekViewResult.lineForeground\":\"#5f7e97\",\"peekViewResult.matchHighlightBackground\":\"#ffffffcc\",\"peekViewResult.selectionBackground\":\"#2e3250\",\"peekViewResult.selectionForeground\":\"#5f7e97\",\"peekViewTitle.background\":\"#011627\",\"peekViewTitleDescription.foreground\":\"#697098\",\"peekViewTitleLabel.foreground\":\"#5f7e97\",\"merge.currentHeaderBackground\":\"#5f7e97\",\"merge.incomingHeaderBackground\":\"#7e57c25a\",\"statusBar.background\":\"#011627\",\"statusBar.foreground\":\"#5f7e97\",\"statusBar.border\":\"#262a39\",\"statusBar.debuggingBackground\":\"#202431\",\"statusBar.debuggingBorder\":\"#1f2330\",\"statusBar.noFolderBackground\":\"#011627\",\"statusBar.noFolderBorder\":\"#25293a\",\"statusBarItem.activeBackground\":\"#202431\",\"statusBarItem.hoverBackground\":\"#202431\",\"statusBarItem.prominentBackground\":\"#202431\",\"statusBarItem.prominentHoverBackground\":\"#202431\",\"notifications.background\":\"#01111d\",\"notifications.border\":\"#262a39\",\"notificationCenter.border\":\"#262a39\",\"notificationToast.border\":\"#262a39\",\"notifications.foreground\":\"#ffffffcc\",\"notificationLink.foreground\":\"#80cbc4\",\"extensionButton.prominentForeground\":\"#ffffffcc\",\"extensionButton.prominentBackground\":\"#7e57c2cc\",\"extensionButton.prominentHoverBackground\":\"#7e57c2\",\"terminal.selectionBackground\":\"#1b90dd4d\",\"terminalCursor.background\":\"#234d70\",\"debugToolBar.background\":\"#011627\",\"welcomePage.buttonBackground\":\"#011627\",\"welcomePage.buttonHoverBackground\":\"#011627\",\"walkThrough.embeddedEditorBackground\":\"#011627\",\"gitDecoration.modifiedResourceForeground\":\"#a2bffc\",\"gitDecoration.deletedResourceForeground\":\"#ef535090\",\"gitDecoration.untrackedResourceForeground\":\"#c5e478ff\",\"gitDecoration.ignoredResourceForeground\":\"#395a75\",\"gitDecoration.conflictingResourceForeground\":\"#ffeb95cc\",\"source.elm\":\"#5f7e97\",\"string.quoted.single.js\":\"#ffffff\",\"meta.objectliteral.js\":\"#82aaff\"},\"fg\":\"#d6deeb\",\"bg\":\"#23262f\",\"semanticHighlighting\":false,\"settings\":[{\"name\":\"Changed\",\"scope\":[\"markup.changed\",\"meta.diff.header.git\",\"meta.diff.header.from-file\",\"meta.diff.header.to-file\"],\"settings\":{\"foreground\":\"#a2bffc\"}},{\"name\":\"Deleted\",\"scope\":[\"markup.deleted.diff\"],\"settings\":{\"foreground\":\"#f27775fe\"}},{\"name\":\"Inserted\",\"scope\":[\"markup.inserted.diff\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Global settings\",\"settings\":{\"background\":\"#011627\",\"foreground\":\"#d6deeb\"}},{\"name\":\"Comment\",\"scope\":[\"comment\"],\"settings\":{\"foreground\":\"#919f9f\",\"fontStyle\":\"\"}},{\"name\":\"String\",\"scope\":[\"string\"],\"settings\":{\"foreground\":\"#ecc48d\"}},{\"name\":\"String Quoted\",\"scope\":[\"string.quoted\",\"variable.other.readwrite.js\"],\"settings\":{\"foreground\":\"#ecc48d\"}},{\"name\":\"Support Constant Math\",\"scope\":[\"support.constant.math\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Number\",\"scope\":[\"constant.numeric\",\"constant.character.numeric\"],\"settings\":{\"foreground\":\"#f78c6c\",\"fontStyle\":\"\"}},{\"name\":\"Built-in constant\",\"scope\":[\"constant.language\",\"punctuation.definition.constant\",\"variable.other.constant\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"User-defined constant\",\"scope\":[\"constant.character\",\"constant.other\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Constant Character Escape\",\"scope\":[\"constant.character.escape\"],\"settings\":{\"foreground\":\"#f78c6c\"}},{\"name\":\"RegExp String\",\"scope\":[\"string.regexp\",\"string.regexp keyword.other\"],\"settings\":{\"foreground\":\"#5ca7e4\"}},{\"name\":\"Comma in functions\",\"scope\":[\"meta.function punctuation.separator.comma\"],\"settings\":{\"foreground\":\"#889fb2\"}},{\"name\":\"Variable\",\"scope\":[\"variable\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Keyword\",\"scope\":[\"punctuation.accessor\",\"keyword\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Storage\",\"scope\":[\"storage\",\"meta.var.expr\",\"meta.class meta.method.declaration meta.var.expr storage.type.js\",\"storage.type.property.js\",\"storage.type.property.ts\",\"storage.type.property.tsx\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Storage type\",\"scope\":[\"storage.type\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Storage type\",\"scope\":[\"storage.type.function.arrow.js\"],\"settings\":{\"fontStyle\":\"\"}},{\"name\":\"Class name\",\"scope\":[\"entity.name.class\",\"meta.class entity.name.type.class\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"Inherited class\",\"scope\":[\"entity.other.inherited-class\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Function name\",\"scope\":[\"entity.name.function\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Meta Tag\",\"scope\":[\"punctuation.definition.tag\",\"meta.tag\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"HTML Tag names\",\"scope\":[\"entity.name.tag\",\"meta.tag.other.html\",\"meta.tag.other.js\",\"meta.tag.other.tsx\",\"entity.name.tag.tsx\",\"entity.name.tag.js\",\"entity.name.tag\",\"meta.tag.js\",\"meta.tag.tsx\",\"meta.tag.html\"],\"settings\":{\"foreground\":\"#caece6\",\"fontStyle\":\"\"}},{\"name\":\"Tag attribute\",\"scope\":[\"entity.other.attribute-name\"],\"settings\":{\"fontStyle\":\"\",\"foreground\":\"#c5e478\"}},{\"name\":\"Entity Name Tag Custom\",\"scope\":[\"entity.name.tag.custom\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Library (function & constant)\",\"scope\":[\"support.function\",\"support.constant\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Support Constant Property Value meta\",\"scope\":[\"support.constant.meta.property-value\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Library class/type\",\"scope\":[\"support.type\",\"support.class\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Support Variable DOM\",\"scope\":[\"support.variable.dom\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Invalid\",\"scope\":[\"invalid\"],\"settings\":{\"background\":\"#ff2c83\",\"foreground\":\"#ffffff\"}},{\"name\":\"Invalid deprecated\",\"scope\":[\"invalid.deprecated\"],\"settings\":{\"foreground\":\"#ffffff\",\"background\":\"#d3423e\"}},{\"name\":\"Keyword Operator\",\"scope\":[\"keyword.operator\"],\"settings\":{\"foreground\":\"#7fdbca\",\"fontStyle\":\"\"}},{\"name\":\"Keyword Operator Relational\",\"scope\":[\"keyword.operator.relational\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Keyword Operator Assignment\",\"scope\":[\"keyword.operator.assignment\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Keyword Operator Arithmetic\",\"scope\":[\"keyword.operator.arithmetic\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Keyword Operator Bitwise\",\"scope\":[\"keyword.operator.bitwise\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Keyword Operator Increment\",\"scope\":[\"keyword.operator.increment\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Keyword Operator Ternary\",\"scope\":[\"keyword.operator.ternary\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Double-Slashed Comment\",\"scope\":[\"comment.line.double-slash\"],\"settings\":{\"foreground\":\"#919f9f\"}},{\"name\":\"Object\",\"scope\":[\"object\"],\"settings\":{\"foreground\":\"#cdebf7\"}},{\"name\":\"Null\",\"scope\":[\"constant.language.null\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"Meta Brace\",\"scope\":[\"meta.brace\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"Meta Delimiter Period\",\"scope\":[\"meta.delimiter.period\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Punctuation Definition String\",\"scope\":[\"punctuation.definition.string\"],\"settings\":{\"foreground\":\"#d9f5dd\"}},{\"name\":\"Punctuation Definition String Markdown\",\"scope\":[\"punctuation.definition.string.begin.markdown\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"Boolean\",\"scope\":[\"constant.language.boolean\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"Object Comma\",\"scope\":[\"object.comma\"],\"settings\":{\"foreground\":\"#ffffff\"}},{\"name\":\"Variable Parameter Function\",\"scope\":[\"variable.parameter.function\"],\"settings\":{\"foreground\":\"#7fdbca\",\"fontStyle\":\"\"}},{\"name\":\"Support Type Property Name & entity name tags\",\"scope\":[\"support.type.vendor.property-name\",\"support.constant.vendor.property-value\",\"support.type.property-name\",\"meta.property-list entity.name.tag\"],\"settings\":{\"foreground\":\"#80cbc4\",\"fontStyle\":\"\"}},{\"name\":\"Entity Name tag reference in stylesheets\",\"scope\":[\"meta.property-list entity.name.tag.reference\"],\"settings\":{\"foreground\":\"#57eaf1\"}},{\"name\":\"Constant Other Color RGB Value Punctuation Definition Constant\",\"scope\":[\"constant.other.color.rgb-value punctuation.definition.constant\"],\"settings\":{\"foreground\":\"#f78c6c\"}},{\"name\":\"Constant Other Color\",\"scope\":[\"constant.other.color\"],\"settings\":{\"foreground\":\"#ffeb95\"}},{\"name\":\"Keyword Other Unit\",\"scope\":[\"keyword.other.unit\"],\"settings\":{\"foreground\":\"#ffeb95\"}},{\"name\":\"Meta Selector\",\"scope\":[\"meta.selector\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Entity Other Attribute Name Id\",\"scope\":[\"entity.other.attribute-name.id\"],\"settings\":{\"foreground\":\"#fad430\"}},{\"name\":\"Meta Property Name\",\"scope\":[\"meta.property-name\"],\"settings\":{\"foreground\":\"#80cbc4\"}},{\"name\":\"Doctypes\",\"scope\":[\"entity.name.tag.doctype\",\"meta.tag.sgml.doctype\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Punctuation Definition Parameters\",\"scope\":[\"punctuation.definition.parameters\"],\"settings\":{\"foreground\":\"#d9f5dd\"}},{\"name\":\"Keyword Control Operator\",\"scope\":[\"keyword.control.operator\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Keyword Operator Logical\",\"scope\":[\"keyword.operator.logical\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Variable Instances\",\"scope\":[\"variable.instance\",\"variable.other.instance\",\"variable.readwrite.instance\",\"variable.other.readwrite.instance\",\"variable.other.property\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Variable Property Other object property\",\"scope\":[\"variable.other.object.property\"],\"settings\":{\"foreground\":\"#faf39f\",\"fontStyle\":\"\"}},{\"name\":\"Variable Property Other object\",\"scope\":[\"variable.other.object.js\"],\"settings\":{\"fontStyle\":\"\"}},{\"name\":\"Entity Name Function\",\"scope\":[\"entity.name.function\"],\"settings\":{\"foreground\":\"#82aaff\",\"fontStyle\":\"\"}},{\"name\":\"Keyword Operator Comparison, returns, imports, and Keyword Operator Ruby\",\"scope\":[\"keyword.control.conditional.js\",\"keyword.operator.comparison\",\"keyword.control.flow.js\",\"keyword.control.flow.ts\",\"keyword.control.flow.tsx\",\"keyword.control.ruby\",\"keyword.control.def.ruby\",\"keyword.control.loop.js\",\"keyword.control.loop.ts\",\"keyword.control.import.js\",\"keyword.control.import.ts\",\"keyword.control.import.tsx\",\"keyword.control.from.js\",\"keyword.control.from.ts\",\"keyword.control.from.tsx\",\"keyword.control.conditional.js\",\"keyword.control.conditional.ts\",\"keyword.control.switch.js\",\"keyword.control.switch.ts\",\"keyword.operator.instanceof.js\",\"keyword.operator.expression.instanceof.ts\",\"keyword.operator.expression.instanceof.tsx\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Support Constant, `new` keyword, Special Method Keyword, `debugger`, other keywords\",\"scope\":[\"support.constant\",\"keyword.other.special-method\",\"keyword.other.new\",\"keyword.other.debugger\",\"keyword.control\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Support Function\",\"scope\":[\"support.function\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Invalid Broken\",\"scope\":[\"invalid.broken\"],\"settings\":{\"foreground\":\"#989da0\",\"background\":\"#F78C6C\"}},{\"name\":\"Invalid Unimplemented\",\"scope\":[\"invalid.unimplemented\"],\"settings\":{\"background\":\"#8BD649\",\"foreground\":\"#ffffff\"}},{\"name\":\"Invalid Illegal\",\"scope\":[\"invalid.illegal\"],\"settings\":{\"foreground\":\"#ffffff\",\"background\":\"#ec5f67\"}},{\"name\":\"Language Variable\",\"scope\":[\"variable.language\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Support Variable Property\",\"scope\":[\"support.variable.property\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Variable Function\",\"scope\":[\"variable.function\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Variable Interpolation\",\"scope\":[\"variable.interpolation\"],\"settings\":{\"foreground\":\"#ef787f\"}},{\"name\":\"Meta Function Call\",\"scope\":[\"meta.function-call\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Punctuation Section Embedded\",\"scope\":[\"punctuation.section.embedded\"],\"settings\":{\"foreground\":\"#e2817f\"}},{\"name\":\"Punctuation Tweaks\",\"scope\":[\"punctuation.terminator.expression\",\"punctuation.definition.arguments\",\"punctuation.definition.array\",\"punctuation.section.array\",\"meta.array\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"More Punctuation Tweaks\",\"scope\":[\"punctuation.definition.list.begin\",\"punctuation.definition.list.end\",\"punctuation.separator.arguments\",\"punctuation.definition.list\"],\"settings\":{\"foreground\":\"#d9f5dd\"}},{\"name\":\"Template Strings\",\"scope\":[\"string.template meta.template.expression\"],\"settings\":{\"foreground\":\"#e2817f\"}},{\"name\":\"Backtics(``) in Template Strings\",\"scope\":[\"string.template punctuation.definition.string\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"Italics\",\"scope\":[\"italic\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"italic\"}},{\"name\":\"Bold\",\"scope\":[\"bold\"],\"settings\":{\"foreground\":\"#c5e478\",\"fontStyle\":\"bold\"}},{\"name\":\"Quote\",\"scope\":[\"quote\"],\"settings\":{\"foreground\":\"#969bb7\",\"fontStyle\":\"\"}},{\"name\":\"Raw Code\",\"scope\":[\"raw\"],\"settings\":{\"foreground\":\"#80cbc4\"}},{\"name\":\"CoffeScript Variable Assignment\",\"scope\":[\"variable.assignment.coffee\"],\"settings\":{\"foreground\":\"#31e1eb\"}},{\"name\":\"CoffeScript Parameter Function\",\"scope\":[\"variable.parameter.function.coffee\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"CoffeeScript Assignments\",\"scope\":[\"variable.assignment.coffee\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"C# Readwrite Variables\",\"scope\":[\"variable.other.readwrite.cs\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"C# Classes & Storage types\",\"scope\":[\"entity.name.type.class.cs\",\"storage.type.cs\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"C# Namespaces\",\"scope\":[\"entity.name.type.namespace.cs\"],\"settings\":{\"foreground\":\"#b2ccd6\"}},{\"name\":\"C# Unquoted String Zone\",\"scope\":[\"string.unquoted.preprocessor.message.cs\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"C# Region\",\"scope\":[\"punctuation.separator.hash.cs\",\"keyword.preprocessor.region.cs\",\"keyword.preprocessor.endregion.cs\"],\"settings\":{\"foreground\":\"#ffcb8b\",\"fontStyle\":\"bold\"}},{\"name\":\"C# Other Variables\",\"scope\":[\"variable.other.object.cs\"],\"settings\":{\"foreground\":\"#b2ccd6\"}},{\"name\":\"C# Enum\",\"scope\":[\"entity.name.type.enum.cs\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Dart String\",\"scope\":[\"string.interpolated.single.dart\",\"string.interpolated.double.dart\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"Dart Class\",\"scope\":[\"support.class.dart\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"Tag names in Stylesheets\",\"scope\":[\"entity.name.tag.css\",\"entity.name.tag.less\",\"entity.name.tag.custom.css\",\"support.constant.property-value.css\"],\"settings\":{\"foreground\":\"#ff6d6d\",\"fontStyle\":\"\"}},{\"name\":\"Wildcard(*) selector in Stylesheets\",\"scope\":[\"entity.name.tag.wildcard.css\",\"entity.name.tag.wildcard.less\",\"entity.name.tag.wildcard.scss\",\"entity.name.tag.wildcard.sass\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"CSS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.css\"],\"settings\":{\"foreground\":\"#ffeb95\"}},{\"name\":\"Attribute Name for CSS\",\"scope\":[\"meta.attribute-selector.css entity.other.attribute-name.attribute\",\"variable.other.readwrite.js\"],\"settings\":{\"foreground\":\"#f78c6c\"}},{\"name\":\"Elixir Classes\",\"scope\":[\"source.elixir support.type.elixir\",\"source.elixir meta.module.elixir entity.name.class.elixir\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Elixir Functions\",\"scope\":[\"source.elixir entity.name.function\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Elixir Constants\",\"scope\":[\"source.elixir constant.other.symbol.elixir\",\"source.elixir constant.other.keywords.elixir\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Elixir String Punctuations\",\"scope\":[\"source.elixir punctuation.definition.string\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Elixir\",\"scope\":[\"source.elixir variable.other.readwrite.module.elixir\",\"source.elixir variable.other.readwrite.module.elixir punctuation.definition.variable.elixir\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Elixir Binary Punctuations\",\"scope\":[\"source.elixir .punctuation.binary.elixir\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"Closure Constant Keyword\",\"scope\":[\"constant.keyword.clojure\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Go Function Calls\",\"scope\":[\"source.go meta.function-call.go\"],\"settings\":{\"foreground\":\"#dddddd\"}},{\"name\":\"Go Keywords\",\"scope\":[\"source.go keyword.package.go\",\"source.go keyword.import.go\",\"source.go keyword.function.go\",\"source.go keyword.type.go\",\"source.go keyword.struct.go\",\"source.go keyword.interface.go\",\"source.go keyword.const.go\",\"source.go keyword.var.go\",\"source.go keyword.map.go\",\"source.go keyword.channel.go\",\"source.go keyword.control.go\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"Go Constants e.g. nil, string format (%s, %d, etc.)\",\"scope\":[\"source.go constant.language.go\",\"source.go constant.other.placeholder.go\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"C++ Functions\",\"scope\":[\"entity.name.function.preprocessor.cpp\",\"entity.scope.name.cpp\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"C++ Meta Namespace\",\"scope\":[\"meta.namespace-block.cpp\"],\"settings\":{\"foreground\":\"#e0dec6\"}},{\"name\":\"C++ Language Primitive Storage\",\"scope\":[\"storage.type.language.primitive.cpp\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"C++ Preprocessor Macro\",\"scope\":[\"meta.preprocessor.macro.cpp\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"C++ Variable Parameter\",\"scope\":[\"variable.parameter\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"Powershell Variables\",\"scope\":[\"variable.other.readwrite.powershell\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Powershell Function\",\"scope\":[\"support.function.powershell\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"ID Attribute Name in HTML\",\"scope\":[\"entity.other.attribute-name.id.html\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"HTML Punctuation Definition Tag\",\"scope\":[\"punctuation.definition.tag.html\"],\"settings\":{\"foreground\":\"#6ae9f0\"}},{\"name\":\"HTML Doctype\",\"scope\":[\"meta.tag.sgml.doctype.html\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"\"}},{\"name\":\"JavaScript Classes\",\"scope\":[\"meta.class entity.name.type.class.js\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"JavaScript Method Declaration e.g. `constructor`\",\"scope\":[\"meta.method.declaration storage.type.js\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"JavaScript Terminator\",\"scope\":[\"terminator.js\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"JavaScript Meta Punctuation Definition\",\"scope\":[\"meta.js punctuation.definition.js\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"Entity Names in Code Documentations\",\"scope\":[\"entity.name.type.instance.jsdoc\",\"entity.name.type.instance.phpdoc\"],\"settings\":{\"foreground\":\"#889fb2\"}},{\"name\":\"Other Variables in Code Documentations\",\"scope\":[\"variable.other.jsdoc\",\"variable.other.phpdoc\"],\"settings\":{\"foreground\":\"#78ccf0\"}},{\"name\":\"JavaScript module imports and exports\",\"scope\":[\"variable.other.meta.import.js\",\"meta.import.js variable.other\",\"variable.other.meta.export.js\",\"meta.export.js variable.other\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"JavaScript Variable Parameter Function\",\"scope\":[\"variable.parameter.function.js\"],\"settings\":{\"foreground\":\"#8b96ea\"}},{\"name\":\"JavaScript[React] Variable Other Object\",\"scope\":[\"variable.other.object.js\",\"variable.other.object.jsx\",\"variable.object.property.js\",\"variable.object.property.jsx\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"JavaScript Variables\",\"scope\":[\"variable.js\",\"variable.other.js\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"JavaScript Entity Name Type\",\"scope\":[\"entity.name.type.js\",\"entity.name.type.module.js\"],\"settings\":{\"foreground\":\"#ffcb8b\",\"fontStyle\":\"\"}},{\"name\":\"JavaScript Support Classes\",\"scope\":[\"support.class.js\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"JSON Property Names\",\"scope\":[\"support.type.property-name.json\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"JSON Support Constants\",\"scope\":[\"support.constant.json\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"JSON Property values (string)\",\"scope\":[\"meta.structure.dictionary.value.json string.quoted.double\"],\"settings\":{\"foreground\":\"#c789d6\"}},{\"name\":\"Strings in JSON values\",\"scope\":[\"string.quoted.double.json punctuation.definition.string.json\"],\"settings\":{\"foreground\":\"#80cbc4\"}},{\"name\":\"Specific JSON Property values like null\",\"scope\":[\"meta.structure.dictionary.json meta.structure.dictionary.value constant.language\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"JavaScript Other Variable\",\"scope\":[\"variable.other.object.js\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Ruby Variables\",\"scope\":[\"variable.other.ruby\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"Ruby Class\",\"scope\":[\"entity.name.type.class.ruby\"],\"settings\":{\"foreground\":\"#ecc48d\"}},{\"name\":\"Ruby Hashkeys\",\"scope\":[\"constant.language.symbol.hashkey.ruby\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"LESS Tag names\",\"scope\":[\"entity.name.tag.less\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"LESS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.css\"],\"settings\":{\"foreground\":\"#ffeb95\"}},{\"name\":\"Attribute Name for LESS\",\"scope\":[\"meta.attribute-selector.less entity.other.attribute-name.attribute\"],\"settings\":{\"foreground\":\"#f78c6c\"}},{\"name\":\"Markdown Headings\",\"scope\":[\"markup.heading.markdown\",\"markup.heading.setext.1.markdown\",\"markup.heading.setext.2.markdown\"],\"settings\":{\"foreground\":\"#82b1ff\"}},{\"name\":\"Markdown Italics\",\"scope\":[\"markup.italic.markdown\"],\"settings\":{\"foreground\":\"#c792ea\",\"fontStyle\":\"italic\"}},{\"name\":\"Markdown Bold\",\"scope\":[\"markup.bold.markdown\"],\"settings\":{\"foreground\":\"#c5e478\",\"fontStyle\":\"bold\"}},{\"name\":\"Markdown Quote + others\",\"scope\":[\"markup.quote.markdown\"],\"settings\":{\"foreground\":\"#969bb7\",\"fontStyle\":\"\"}},{\"name\":\"Markdown Raw Code + others\",\"scope\":[\"markup.inline.raw.markdown\"],\"settings\":{\"foreground\":\"#80cbc4\"}},{\"name\":\"Markdown Links\",\"scope\":[\"markup.underline.link.markdown\",\"markup.underline.link.image.markdown\"],\"settings\":{\"foreground\":\"#ff869a\",\"fontStyle\":\"underline\"}},{\"name\":\"Markdown Link Title and Description\",\"scope\":[\"string.other.link.title.markdown\",\"string.other.link.description.markdown\"],\"settings\":{\"foreground\":\"#d6deeb\",\"fontStyle\":\"underline\"}},{\"name\":\"Markdown Punctuation\",\"scope\":[\"punctuation.definition.string.markdown\",\"punctuation.definition.string.begin.markdown\",\"punctuation.definition.string.end.markdown\",\"meta.link.inline.markdown punctuation.definition.string\"],\"settings\":{\"foreground\":\"#82b1ff\"}},{\"name\":\"Markdown MetaData Punctuation\",\"scope\":[\"punctuation.definition.metadata.markdown\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"Markdown List Punctuation\",\"scope\":[\"beginning.punctuation.definition.list.markdown\"],\"settings\":{\"foreground\":\"#82b1ff\"}},{\"name\":\"Markdown Inline Raw String\",\"scope\":[\"markup.inline.raw.string.markdown\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"PHP Variables\",\"scope\":[\"variable.other.php\"],\"settings\":{\"foreground\":\"#bec5d4\"}},{\"name\":\"Support Classes in PHP\",\"scope\":[\"support.class.php\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"Punctuations in PHP function calls\",\"scope\":[\"meta.function-call.php punctuation\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"PHP Global Variables\",\"scope\":[\"variable.other.global.php\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Declaration Punctuation in PHP Global Variables\",\"scope\":[\"variable.other.global.php punctuation.definition.variable\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Language Constants in Python\",\"scope\":[\"constant.language.python\"],\"settings\":{\"foreground\":\"#ff6a83\"}},{\"name\":\"Python Function Parameter and Arguments\",\"scope\":[\"variable.parameter.function.python\",\"meta.function-call.arguments.python\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Python Function Call\",\"scope\":[\"meta.function-call.python\",\"meta.function-call.generic.python\"],\"settings\":{\"foreground\":\"#b2ccd6\"}},{\"name\":\"Punctuations in Python\",\"scope\":[\"punctuation.python\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"Decorator Functions in Python\",\"scope\":[\"entity.name.function.decorator.python\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Python Language Variable\",\"scope\":[\"source.python variable.language.special\"],\"settings\":{\"foreground\":\"#8eace3\"}},{\"name\":\"Python import control keyword\",\"scope\":[\"keyword.control\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"SCSS Variable\",\"scope\":[\"variable.scss\",\"variable.sass\",\"variable.parameter.url.scss\",\"variable.parameter.url.sass\"],\"settings\":{\"foreground\":\"#c5e478\"}},{\"name\":\"Variables in SASS At-Rules\",\"scope\":[\"source.css.scss meta.at-rule variable\",\"source.css.sass meta.at-rule variable\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"Variables in SASS At-Rules\",\"scope\":[\"source.css.scss meta.at-rule variable\",\"source.css.sass meta.at-rule variable\"],\"settings\":{\"foreground\":\"#bec5d4\"}},{\"name\":\"Attribute Name for SASS\",\"scope\":[\"meta.attribute-selector.scss entity.other.attribute-name.attribute\",\"meta.attribute-selector.sass entity.other.attribute-name.attribute\"],\"settings\":{\"foreground\":\"#f78c6c\"}},{\"name\":\"Tag names in SASS\",\"scope\":[\"entity.name.tag.scss\",\"entity.name.tag.sass\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"SASS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.scss\",\"keyword.other.unit.sass\"],\"settings\":{\"foreground\":\"#ffeb95\"}},{\"name\":\"TypeScript[React] Variables and Object Properties\",\"scope\":[\"variable.other.readwrite.alias.ts\",\"variable.other.readwrite.alias.tsx\",\"variable.other.readwrite.ts\",\"variable.other.readwrite.tsx\",\"variable.other.object.ts\",\"variable.other.object.tsx\",\"variable.object.property.ts\",\"variable.object.property.tsx\",\"variable.other.ts\",\"variable.other.tsx\",\"variable.tsx\",\"variable.ts\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"TypeScript[React] Entity Name Types\",\"scope\":[\"entity.name.type.ts\",\"entity.name.type.tsx\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"TypeScript[React] Node Classes\",\"scope\":[\"support.class.node.ts\",\"support.class.node.tsx\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"TypeScript[React] Entity Name Types as Parameters\",\"scope\":[\"meta.type.parameters.ts entity.name.type\",\"meta.type.parameters.tsx entity.name.type\"],\"settings\":{\"foreground\":\"#889fb2\"}},{\"name\":\"TypeScript[React] Import/Export Punctuations\",\"scope\":[\"meta.import.ts punctuation.definition.block\",\"meta.import.tsx punctuation.definition.block\",\"meta.export.ts punctuation.definition.block\",\"meta.export.tsx punctuation.definition.block\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"TypeScript[React] Punctuation Decorators\",\"scope\":[\"meta.decorator punctuation.decorator.ts\",\"meta.decorator punctuation.decorator.tsx\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"TypeScript[React] Punctuation Decorators\",\"scope\":[\"meta.tag.js meta.jsx.children.tsx\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"YAML Entity Name Tags\",\"scope\":[\"entity.name.tag.yaml\"],\"settings\":{\"foreground\":\"#7fdbca\"}},{\"name\":\"JavaScript Variable Other ReadWrite\",\"scope\":[\"variable.other.readwrite.js\",\"variable.parameter\"],\"settings\":{\"foreground\":\"#d7dbe0\"}},{\"name\":\"Support Class Component\",\"scope\":[\"support.class.component.js\",\"support.class.component.tsx\"],\"settings\":{\"foreground\":\"#f78c6c\",\"fontStyle\":\"\"}},{\"name\":\"Text nested in React tags\",\"scope\":[\"meta.jsx.children\",\"meta.jsx.children.js\",\"meta.jsx.children.tsx\"],\"settings\":{\"foreground\":\"#d6deeb\"}},{\"name\":\"TypeScript Classes\",\"scope\":[\"meta.class entity.name.type.class.tsx\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"TypeScript Entity Name Type\",\"scope\":[\"entity.name.type.tsx\",\"entity.name.type.module.tsx\"],\"settings\":{\"foreground\":\"#ffcb8b\"}},{\"name\":\"TypeScript Class Variable Keyword\",\"scope\":[\"meta.class.ts meta.var.expr.ts storage.type.ts\",\"meta.class.tsx meta.var.expr.tsx storage.type.tsx\"],\"settings\":{\"foreground\":\"#c792ea\"}},{\"name\":\"TypeScript Method Declaration e.g. `constructor`\",\"scope\":[\"meta.method.declaration storage.type.ts\",\"meta.method.declaration storage.type.tsx\"],\"settings\":{\"foreground\":\"#82aaff\"}},{\"name\":\"normalize font style of certain components\",\"scope\":[\"meta.property-list.css meta.property-value.css variable.other.less\",\"meta.property-list.scss variable.scss\",\"meta.property-list.sass variable.sass\",\"meta.brace\",\"keyword.operator.operator\",\"keyword.operator.or.regexp\",\"keyword.operator.expression.in\",\"keyword.operator.relational\",\"keyword.operator.assignment\",\"keyword.operator.comparison\",\"keyword.operator.type\",\"keyword.operator\",\"keyword\",\"punctuation.definintion.string\",\"punctuation\",\"variable.other.readwrite.js\",\"storage.type\",\"source.css\",\"string.quoted\"],\"settings\":{\"fontStyle\":\"\"}}],\"styleOverrides\":{\"frames\":{\"editorBackground\":\"var(--sl-color-gray-6)\",\"terminalBackground\":\"var(--sl-color-gray-6)\",\"editorActiveTabBackground\":\"var(--sl-color-gray-6)\",\"terminalTitlebarDotsForeground\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"terminalTitlebarDotsOpacity\":\"0.75\",\"inlineButtonForeground\":\"var(--sl-color-text)\",\"frameBoxShadowCssValue\":\"none\"},\"textMarkers\":{\"markBackground\":\"#ffffff17\",\"markBorderColor\":\"#ffffff40\"}}},{\"name\":\"Night Owl Light\",\"type\":\"light\",\"colors\":{\"focusBorder\":\"#93a1a1\",\"foreground\":\"#403f53\",\"disabledForeground\":\"#61616180\",\"descriptionForeground\":\"#403f53\",\"errorForeground\":\"#403f53\",\"icon.foreground\":\"#424242\",\"contrastActiveBorder\":null,\"contrastBorder\":null,\"textBlockQuote.background\":\"#7f7f7f1a\",\"textBlockQuote.border\":\"#007acc80\",\"textCodeBlock.background\":\"#dcdcdc66\",\"textLink.activeForeground\":\"#006ab1\",\"textLink.foreground\":\"#006ab1\",\"textPreformat.foreground\":\"#a31515\",\"textSeparator.foreground\":\"#0000002e\",\"editor.background\":\"#f6f7f9\",\"editor.foreground\":\"#403f53\",\"editorLineNumber.foreground\":\"#90a7b2\",\"editorLineNumber.activeForeground\":\"#403f53\",\"editorActiveLineNumber.foreground\":\"#0b216f\",\"editor.selectionBackground\":\"#e0e0e0\",\"editor.inactiveSelectionBackground\":\"#e0e0e080\",\"editor.selectionHighlightBackground\":\"#339cec33\",\"editorError.foreground\":\"#e64d49\",\"editorWarning.foreground\":\"#daaa01\",\"editorInfo.foreground\":\"#1a85ff\",\"editorHint.foreground\":\"#6c6c6c\",\"problemsErrorIcon.foreground\":\"#e64d49\",\"problemsWarningIcon.foreground\":\"#daaa01\",\"problemsInfoIcon.foreground\":\"#1a85ff\",\"editor.findMatchBackground\":\"#93a1a16c\",\"editor.findMatchHighlightBackground\":\"#93a1a16c\",\"editor.findRangeHighlightBackground\":\"#7497a633\",\"editorLink.activeForeground\":\"#0000ff\",\"editorLightBulb.foreground\":\"#ddb100\",\"editorLightBulbAutoFix.foreground\":\"#007acc\",\"diffEditor.insertedTextBackground\":\"#9ccc2c40\",\"diffEditor.insertedTextBorder\":null,\"diffEditor.removedTextBackground\":\"#ff000033\",\"diffEditor.removedTextBorder\":null,\"diffEditor.insertedLineBackground\":\"#9bb95533\",\"diffEditor.removedLineBackground\":\"#ff000033\",\"editorStickyScroll.background\":\"#fbfbfb\",\"editorStickyScrollHover.background\":\"#f0f0f0\",\"editorInlayHint.background\":\"#2aa29899\",\"editorInlayHint.foreground\":\"#f0f0f0\",\"editorInlayHint.typeBackground\":\"#2aa29899\",\"editorInlayHint.typeForeground\":\"#f0f0f0\",\"editorInlayHint.parameterBackground\":\"#2aa29899\",\"editorInlayHint.parameterForeground\":\"#f0f0f0\",\"editorPane.background\":\"#fbfbfb\",\"editorGroup.emptyBackground\":null,\"editorGroup.focusedEmptyBorder\":null,\"editorGroupHeader.tabsBackground\":\"var(--sl-color-gray-6)\",\"editorGroupHeader.tabsBorder\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"editorGroupHeader.noTabsBackground\":\"#f0f0f0\",\"editorGroupHeader.border\":null,\"editorGroup.border\":\"#f0f0f0\",\"editorGroup.dropBackground\":\"#2677cb2d\",\"editorGroup.dropIntoPromptForeground\":\"#403f53\",\"editorGroup.dropIntoPromptBackground\":\"#f0f0f0\",\"editorGroup.dropIntoPromptBorder\":null,\"sideBySideEditor.horizontalBorder\":\"#f0f0f0\",\"sideBySideEditor.verticalBorder\":\"#f0f0f0\",\"scrollbar.shadow\":\"#cccccc\",\"scrollbarSlider.background\":\"#0000001a\",\"scrollbarSlider.hoverBackground\":\"#00000055\",\"scrollbarSlider.activeBackground\":\"#00000099\",\"panel.background\":\"#f0f0f0\",\"panel.border\":\"#d9d9d9\",\"panelTitle.activeBorder\":\"#424242\",\"panelTitle.activeForeground\":\"#424242\",\"panelTitle.inactiveForeground\":\"#424242bf\",\"panelSectionHeader.background\":\"#80808051\",\"terminal.background\":\"#f6f6f6\",\"widget.shadow\":\"#d9d9d9\",\"editorWidget.background\":\"#f0f0f0\",\"editorWidget.foreground\":\"#403f53\",\"editorWidget.border\":\"#d9d9d9\",\"quickInput.background\":\"#f0f0f0\",\"quickInput.foreground\":\"#403f53\",\"quickInputTitle.background\":\"#0000000f\",\"pickerGroup.foreground\":\"#403f53\",\"pickerGroup.border\":\"#d9d9d9\",\"editor.hoverHighlightBackground\":\"#339cec33\",\"editorHoverWidget.background\":\"#f0f0f0\",\"editorHoverWidget.foreground\":\"#403f53\",\"editorHoverWidget.border\":\"#d9d9d9\",\"editorHoverWidget.statusBarBackground\":\"#e4e4e4\",\"titleBar.activeBackground\":\"var(--sl-color-gray-6)\",\"titleBar.activeForeground\":\"var(--sl-color-text)\",\"titleBar.inactiveBackground\":\"#f0f0f099\",\"titleBar.inactiveForeground\":\"#33333399\",\"titleBar.border\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"toolbar.hoverBackground\":\"#b8b8b850\",\"toolbar.activeBackground\":\"#a6a6a650\",\"tab.activeBackground\":\"#f6f6f6\",\"tab.unfocusedActiveBackground\":\"#f6f6f6\",\"tab.inactiveBackground\":\"#f0f0f0\",\"tab.unfocusedInactiveBackground\":\"#f0f0f0\",\"tab.activeForeground\":\"var(--sl-color-text)\",\"tab.inactiveForeground\":\"#403f53\",\"tab.unfocusedActiveForeground\":\"#403f53b3\",\"tab.unfocusedInactiveForeground\":\"#403f5380\",\"tab.hoverBackground\":null,\"tab.unfocusedHoverBackground\":null,\"tab.hoverForeground\":null,\"tab.unfocusedHoverForeground\":null,\"tab.border\":\"#f0f0f0\",\"tab.lastPinnedBorder\":\"#a9a9a9\",\"tab.activeBorder\":\"transparent\",\"tab.unfocusedActiveBorder\":null,\"tab.activeBorderTop\":\"var(--sl-color-accent)\",\"tab.unfocusedActiveBorderTop\":null,\"tab.hoverBorder\":null,\"tab.unfocusedHoverBorder\":null,\"tab.activeModifiedBorder\":\"#2aa298\",\"tab.inactiveModifiedBorder\":\"#93a1a1\",\"tab.unfocusedActiveModifiedBorder\":\"#93a1a1\",\"tab.unfocusedInactiveModifiedBorder\":\"#93a1a1\",\"badge.background\":\"#2aa298\",\"badge.foreground\":\"#f0f0f0\",\"button.background\":\"#2aa298\",\"button.foreground\":\"#f0f0f0\",\"button.border\":null,\"button.separator\":\"#f0f0f066\",\"button.hoverBackground\":\"#22827a\",\"button.secondaryBackground\":\"#5f6a79\",\"button.secondaryForeground\":\"#ffffff\",\"button.secondaryHoverBackground\":\"#4c5561\",\"dropdown.background\":\"#f0f0f0\",\"dropdown.foreground\":\"#403f53\",\"dropdown.border\":\"#d9d9d9\",\"list.activeSelectionBackground\":\"#d3e8f8\",\"list.activeSelectionForeground\":\"#403f53\",\"tree.indentGuidesStroke\":\"#a9a9a9\",\"input.background\":\"#f0f0f0\",\"input.foreground\":\"#403f53\",\"input.placeholderForeground\":\"#93a1a1\",\"inputOption.activeBorder\":\"#2aa298\",\"inputOption.hoverBackground\":\"#b8b8b850\",\"inputOption.activeBackground\":\"#93a1a133\",\"inputOption.activeForeground\":\"#000000\",\"inputValidation.infoBackground\":\"#f0f0f0\",\"inputValidation.infoBorder\":\"#d0d0d0\",\"inputValidation.warningBackground\":\"#daaa01\",\"inputValidation.warningBorder\":\"#e0af02\",\"inputValidation.errorBackground\":\"#f76e6e\",\"inputValidation.errorBorder\":\"#de3d3b\",\"keybindingLabel.background\":\"#dddddd66\",\"keybindingLabel.foreground\":\"#555555\",\"keybindingLabel.border\":\"#cccccc66\",\"keybindingLabel.bottomBorder\":\"#bbbbbb66\",\"menu.foreground\":\"#403f53\",\"menu.background\":\"#f0f0f0\",\"menu.selectionForeground\":\"#403f53\",\"menu.selectionBackground\":\"#d3e8f8\",\"menu.separatorBackground\":\"#d4d4d4\",\"editor.snippetTabstopHighlightBackground\":\"#0a326433\",\"editor.snippetFinalTabstopHighlightBorder\":\"#0a326480\",\"terminal.ansiBlack\":\"#403f53\",\"terminal.ansiRed\":\"#de3d3b\",\"terminal.ansiGreen\":\"#08916a\",\"terminal.ansiYellow\":\"#e0af02\",\"terminal.ansiBlue\":\"#288ed7\",\"terminal.ansiMagenta\":\"#d6438a\",\"terminal.ansiCyan\":\"#2aa298\",\"terminal.ansiWhite\":\"#f0f0f0\",\"terminal.ansiBrightBlack\":\"#403f53\",\"terminal.ansiBrightRed\":\"#de3d3b\",\"terminal.ansiBrightGreen\":\"#08916a\",\"terminal.ansiBrightYellow\":\"#daaa01\",\"terminal.ansiBrightBlue\":\"#288ed7\",\"terminal.ansiBrightMagenta\":\"#d6438a\",\"terminal.ansiBrightCyan\":\"#2aa298\",\"terminal.ansiBrightWhite\":\"#f0f0f0\",\"selection.background\":\"#7a8181ad\",\"notifications.background\":\"#f0f0f0\",\"notifications.foreground\":\"#403f53\",\"notificationLink.foreground\":\"#994cc3\",\"notifications.border\":\"#cccccc\",\"notificationCenter.border\":\"#cccccc\",\"notificationToast.border\":\"#cccccc\",\"notificationCenterHeader.foreground\":\"#403f53\",\"notificationCenterHeader.background\":\"#f0f0f0\",\"input.border\":\"#d9d9d9\",\"progressBar.background\":\"#2aa298\",\"list.inactiveSelectionBackground\":\"#e0e7ea\",\"list.inactiveSelectionForeground\":\"#403f53\",\"list.focusBackground\":\"#d3e8f8\",\"list.hoverBackground\":\"#d3e8f8\",\"list.focusForeground\":\"#403f53\",\"list.hoverForeground\":\"#403f53\",\"list.highlightForeground\":\"#403f53\",\"list.errorForeground\":\"#e64d49\",\"list.warningForeground\":\"#daaa01\",\"activityBar.background\":\"#f0f0f0\",\"activityBar.foreground\":\"#403f53\",\"activityBar.dropBackground\":\"#d0d0d0\",\"activityBarBadge.background\":\"#403f53\",\"activityBarBadge.foreground\":\"#f0f0f0\",\"activityBar.border\":\"#f0f0f0\",\"sideBar.background\":\"#f0f0f0\",\"sideBar.foreground\":\"#403f53\",\"sideBarTitle.foreground\":\"#403f53\",\"sideBar.border\":\"#f0f0f0\",\"editorGroup.background\":\"#f6f6f6\",\"editorCursor.foreground\":\"#90a7b2\",\"editor.wordHighlightBackground\":\"#339cec33\",\"editor.wordHighlightStrongBackground\":\"#007dd659\",\"editor.lineHighlightBackground\":\"#f0f0f0\",\"editor.rangeHighlightBackground\":\"#7497a633\",\"editorWhitespace.foreground\":\"#d9d9d9\",\"editorIndentGuide.background\":\"#d9d9d9\",\"editorCodeLens.foreground\":\"#403f53\",\"editorBracketMatch.background\":\"#d3e8f8\",\"editorBracketMatch.border\":\"#2aa298\",\"editorError.border\":\"#fbfbfb\",\"editorWarning.border\":\"#daaa01\",\"editorGutter.addedBackground\":\"#49d0c5\",\"editorGutter.modifiedBackground\":\"#6fbef6\",\"editorGutter.deletedBackground\":\"#f76e6e\",\"editorRuler.foreground\":\"#d9d9d9\",\"editorOverviewRuler.errorForeground\":\"#e64d49\",\"editorOverviewRuler.warningForeground\":\"#daaa01\",\"editorSuggestWidget.background\":\"#f0f0f0\",\"editorSuggestWidget.foreground\":\"#403f53\",\"editorSuggestWidget.highlightForeground\":\"#403f53\",\"editorSuggestWidget.selectedBackground\":\"#d3e8f8\",\"editorSuggestWidget.border\":\"#d9d9d9\",\"debugExceptionWidget.background\":\"#f0f0f0\",\"debugExceptionWidget.border\":\"#d9d9d9\",\"editorMarkerNavigation.background\":\"#d0d0d0\",\"editorMarkerNavigationError.background\":\"#f76e6e\",\"editorMarkerNavigationWarning.background\":\"#daaa01\",\"debugToolBar.background\":\"#f0f0f0\",\"extensionButton.prominentBackground\":\"#2aa298\",\"extensionButton.prominentForeground\":\"#f0f0f0\",\"statusBar.background\":\"#f0f0f0\",\"statusBar.border\":\"#f0f0f0\",\"statusBar.debuggingBackground\":\"#f0f0f0\",\"statusBar.debuggingForeground\":\"#403f53\",\"statusBar.foreground\":\"#403f53\",\"statusBar.noFolderBackground\":\"#f0f0f0\",\"statusBar.noFolderForeground\":\"#403f53\",\"peekView.border\":\"#d9d9d9\",\"peekViewEditor.background\":\"#f6f6f6\",\"peekViewEditorGutter.background\":\"#f6f6f6\",\"peekViewEditor.matchHighlightBackground\":\"#49d0c5\",\"peekViewResult.background\":\"#f0f0f0\",\"peekViewResult.fileForeground\":\"#403f53\",\"peekViewResult.lineForeground\":\"#403f53\",\"peekViewResult.matchHighlightBackground\":\"#49d0c5\",\"peekViewResult.selectionBackground\":\"#e0e7ea\",\"peekViewResult.selectionForeground\":\"#403f53\",\"peekViewTitle.background\":\"#f0f0f0\",\"peekViewTitleLabel.foreground\":\"#403f53\",\"peekViewTitleDescription.foreground\":\"#403f53\",\"terminal.foreground\":\"#403f53\"},\"fg\":\"#403f53\",\"bg\":\"#f6f7f9\",\"semanticHighlighting\":false,\"settings\":[{\"name\":\"Changed\",\"scope\":[\"markup.changed\",\"meta.diff.header.git\",\"meta.diff.header.from-file\",\"meta.diff.header.to-file\"],\"settings\":{\"foreground\":\"#556484\"}},{\"name\":\"Deleted\",\"scope\":[\"markup.deleted.diff\"],\"settings\":{\"foreground\":\"#ae3c3afd\"}},{\"name\":\"Inserted\",\"scope\":[\"markup.inserted.diff\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Global settings\",\"settings\":{\"background\":\"#011627\",\"foreground\":\"#403f53\"}},{\"name\":\"Comment\",\"scope\":[\"comment\"],\"settings\":{\"foreground\":\"#5f636f\"}},{\"name\":\"String\",\"scope\":[\"string\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"String Quoted\",\"scope\":[\"string.quoted\",\"variable.other.readwrite.js\"],\"settings\":{\"foreground\":\"#984e4d\"}},{\"name\":\"Support Constant Math\",\"scope\":[\"support.constant.math\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Number\",\"scope\":[\"constant.numeric\",\"constant.character.numeric\"],\"settings\":{\"foreground\":\"#aa0982\",\"fontStyle\":\"\"}},{\"name\":\"Built-in constant\",\"scope\":[\"constant.language\",\"punctuation.definition.constant\",\"variable.other.constant\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"User-defined constant\",\"scope\":[\"constant.character\",\"constant.other\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Constant Character Escape\",\"scope\":[\"constant.character.escape\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"RegExp String\",\"scope\":[\"string.regexp\",\"string.regexp keyword.other\"],\"settings\":{\"foreground\":\"#3a688f\"}},{\"name\":\"Comma in functions\",\"scope\":[\"meta.function punctuation.separator.comma\"],\"settings\":{\"foreground\":\"#4d667b\"}},{\"name\":\"Variable\",\"scope\":[\"variable\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Keyword\",\"scope\":[\"punctuation.accessor\",\"keyword\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Storage\",\"scope\":[\"storage\",\"meta.var.expr\",\"meta.class meta.method.declaration meta.var.expr storage.type.js\",\"storage.type.property.js\",\"storage.type.property.ts\",\"storage.type.property.tsx\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Storage type\",\"scope\":[\"storage.type\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Storage type\",\"scope\":[\"storage.type.function.arrow.js\"],\"settings\":{\"fontStyle\":\"\"}},{\"name\":\"Class name\",\"scope\":[\"entity.name.class\",\"meta.class entity.name.type.class\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Inherited class\",\"scope\":[\"entity.other.inherited-class\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Function name\",\"scope\":[\"entity.name.function\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Meta Tag\",\"scope\":[\"punctuation.definition.tag\",\"meta.tag\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"HTML Tag names\",\"scope\":[\"entity.name.tag\",\"meta.tag.other.html\",\"meta.tag.other.js\",\"meta.tag.other.tsx\",\"entity.name.tag.tsx\",\"entity.name.tag.js\",\"entity.name.tag\",\"meta.tag.js\",\"meta.tag.tsx\",\"meta.tag.html\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Tag attribute\",\"scope\":[\"entity.other.attribute-name\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Entity Name Tag Custom\",\"scope\":[\"entity.name.tag.custom\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Library (function & constant)\",\"scope\":[\"support.function\",\"support.constant\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Support Constant Property Value meta\",\"scope\":[\"support.constant.meta.property-value\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Library class/type\",\"scope\":[\"support.type\",\"support.class\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Support Variable DOM\",\"scope\":[\"support.variable.dom\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Invalid\",\"scope\":[\"invalid\"],\"settings\":{\"foreground\":\"#bb2060\"}},{\"name\":\"Invalid deprecated\",\"scope\":[\"invalid.deprecated\"],\"settings\":{\"foreground\":\"#b23834\"}},{\"name\":\"Keyword Operator\",\"scope\":[\"keyword.operator\"],\"settings\":{\"foreground\":\"#096e72\",\"fontStyle\":\"\"}},{\"name\":\"Keyword Operator Relational\",\"scope\":[\"keyword.operator.relational\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Operator Assignment\",\"scope\":[\"keyword.operator.assignment\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Operator Arithmetic\",\"scope\":[\"keyword.operator.arithmetic\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Operator Bitwise\",\"scope\":[\"keyword.operator.bitwise\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Operator Increment\",\"scope\":[\"keyword.operator.increment\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Operator Ternary\",\"scope\":[\"keyword.operator.ternary\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Double-Slashed Comment\",\"scope\":[\"comment.line.double-slash\"],\"settings\":{\"foreground\":\"#5d6376\"}},{\"name\":\"Object\",\"scope\":[\"object\"],\"settings\":{\"foreground\":\"#58656a\"}},{\"name\":\"Null\",\"scope\":[\"constant.language.null\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"Meta Brace\",\"scope\":[\"meta.brace\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Meta Delimiter Period\",\"scope\":[\"meta.delimiter.period\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Punctuation Definition String\",\"scope\":[\"punctuation.definition.string\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Punctuation Definition String Markdown\",\"scope\":[\"punctuation.definition.string.begin.markdown\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"Boolean\",\"scope\":[\"constant.language.boolean\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"Object Comma\",\"scope\":[\"object.comma\"],\"settings\":{\"foreground\":\"#646464\"}},{\"name\":\"Variable Parameter Function\",\"scope\":[\"variable.parameter.function\"],\"settings\":{\"foreground\":\"#096e72\",\"fontStyle\":\"\"}},{\"name\":\"Support Type Property Name & entity name tags\",\"scope\":[\"support.type.vendor.property-name\",\"support.constant.vendor.property-value\",\"support.type.property-name\",\"meta.property-list entity.name.tag\"],\"settings\":{\"foreground\":\"#096e72\",\"fontStyle\":\"\"}},{\"name\":\"Entity Name tag reference in stylesheets\",\"scope\":[\"meta.property-list entity.name.tag.reference\"],\"settings\":{\"foreground\":\"#286d70\"}},{\"name\":\"Constant Other Color RGB Value Punctuation Definition Constant\",\"scope\":[\"constant.other.color.rgb-value punctuation.definition.constant\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Constant Other Color\",\"scope\":[\"constant.other.color\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Keyword Other Unit\",\"scope\":[\"keyword.other.unit\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Meta Selector\",\"scope\":[\"meta.selector\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Entity Other Attribute Name Id\",\"scope\":[\"entity.other.attribute-name.id\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Meta Property Name\",\"scope\":[\"meta.property-name\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Doctypes\",\"scope\":[\"entity.name.tag.doctype\",\"meta.tag.sgml.doctype\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Punctuation Definition Parameters\",\"scope\":[\"punctuation.definition.parameters\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Keyword Control Operator\",\"scope\":[\"keyword.control.operator\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Keyword Operator Logical\",\"scope\":[\"keyword.operator.logical\"],\"settings\":{\"foreground\":\"#8844ae\",\"fontStyle\":\"\"}},{\"name\":\"Variable Instances\",\"scope\":[\"variable.instance\",\"variable.other.instance\",\"variable.readwrite.instance\",\"variable.other.readwrite.instance\",\"variable.other.property\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Variable Property Other object property\",\"scope\":[\"variable.other.object.property\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Variable Property Other object\",\"scope\":[\"variable.other.object.js\"],\"settings\":{\"fontStyle\":\"\"}},{\"name\":\"Entity Name Function\",\"scope\":[\"entity.name.function\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Keyword Operator Comparison, imports, returns and Keyword Operator Ruby\",\"scope\":[\"keyword.operator.comparison\",\"keyword.control.flow.js\",\"keyword.control.flow.ts\",\"keyword.control.flow.tsx\",\"keyword.control.ruby\",\"keyword.control.module.ruby\",\"keyword.control.class.ruby\",\"keyword.control.def.ruby\",\"keyword.control.loop.js\",\"keyword.control.loop.ts\",\"keyword.control.import.js\",\"keyword.control.import.ts\",\"keyword.control.import.tsx\",\"keyword.control.from.js\",\"keyword.control.from.ts\",\"keyword.control.from.tsx\",\"keyword.operator.instanceof.js\",\"keyword.operator.expression.instanceof.ts\",\"keyword.operator.expression.instanceof.tsx\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Keyword Control Conditional\",\"scope\":[\"keyword.control.conditional.js\",\"keyword.control.conditional.ts\",\"keyword.control.switch.js\",\"keyword.control.switch.ts\"],\"settings\":{\"foreground\":\"#8844ae\",\"fontStyle\":\"\"}},{\"name\":\"Support Constant, `new` keyword, Special Method Keyword, `debugger`, other keywords\",\"scope\":[\"support.constant\",\"keyword.other.special-method\",\"keyword.other.new\",\"keyword.other.debugger\",\"keyword.control\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Support Function\",\"scope\":[\"support.function\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Invalid Broken\",\"scope\":[\"invalid.broken\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Invalid Unimplemented\",\"scope\":[\"invalid.unimplemented\"],\"settings\":{\"foreground\":\"#486e26\"}},{\"name\":\"Invalid Illegal\",\"scope\":[\"invalid.illegal\"],\"settings\":{\"foreground\":\"#984e4d\"}},{\"name\":\"Language Variable\",\"scope\":[\"variable.language\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Support Variable Property\",\"scope\":[\"support.variable.property\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Variable Function\",\"scope\":[\"variable.function\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Variable Interpolation\",\"scope\":[\"variable.interpolation\"],\"settings\":{\"foreground\":\"#a64348\"}},{\"name\":\"Meta Function Call\",\"scope\":[\"meta.function-call\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Punctuation Section Embedded\",\"scope\":[\"punctuation.section.embedded\"],\"settings\":{\"foreground\":\"#b23834\"}},{\"name\":\"Punctuation Tweaks\",\"scope\":[\"punctuation.terminator.expression\",\"punctuation.definition.arguments\",\"punctuation.definition.array\",\"punctuation.section.array\",\"meta.array\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"More Punctuation Tweaks\",\"scope\":[\"punctuation.definition.list.begin\",\"punctuation.definition.list.end\",\"punctuation.separator.arguments\",\"punctuation.definition.list\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Template Strings\",\"scope\":[\"string.template meta.template.expression\"],\"settings\":{\"foreground\":\"#b23834\"}},{\"name\":\"Backtics(``) in Template Strings\",\"scope\":[\"string.template punctuation.definition.string\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Italics\",\"scope\":[\"italic\"],\"settings\":{\"foreground\":\"#8844ae\",\"fontStyle\":\"italic\"}},{\"name\":\"Bold\",\"scope\":[\"bold\"],\"settings\":{\"foreground\":\"#3b61b0\",\"fontStyle\":\"bold\"}},{\"name\":\"Quote\",\"scope\":[\"quote\"],\"settings\":{\"foreground\":\"#5c6285\"}},{\"name\":\"Raw Code\",\"scope\":[\"raw\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"CoffeScript Variable Assignment\",\"scope\":[\"variable.assignment.coffee\"],\"settings\":{\"foreground\":\"#186e73\"}},{\"name\":\"CoffeScript Parameter Function\",\"scope\":[\"variable.parameter.function.coffee\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"CoffeeScript Assignments\",\"scope\":[\"variable.assignment.coffee\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"C# Readwrite Variables\",\"scope\":[\"variable.other.readwrite.cs\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"C# Classes & Storage types\",\"scope\":[\"entity.name.type.class.cs\",\"storage.type.cs\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"C# Namespaces\",\"scope\":[\"entity.name.type.namespace.cs\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Tag names in Stylesheets\",\"scope\":[\"entity.name.tag.css\",\"entity.name.tag.less\",\"entity.name.tag.custom.css\",\"support.constant.property-value.css\"],\"settings\":{\"foreground\":\"#984e4d\",\"fontStyle\":\"\"}},{\"name\":\"Wildcard(*) selector in Stylesheets\",\"scope\":[\"entity.name.tag.wildcard.css\",\"entity.name.tag.wildcard.less\",\"entity.name.tag.wildcard.scss\",\"entity.name.tag.wildcard.sass\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"CSS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.css\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Attribute Name for CSS\",\"scope\":[\"meta.attribute-selector.css entity.other.attribute-name.attribute\",\"variable.other.readwrite.js\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Elixir Classes\",\"scope\":[\"source.elixir support.type.elixir\",\"source.elixir meta.module.elixir entity.name.class.elixir\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Elixir Functions\",\"scope\":[\"source.elixir entity.name.function\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Elixir Constants\",\"scope\":[\"source.elixir constant.other.symbol.elixir\",\"source.elixir constant.other.keywords.elixir\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Elixir String Punctuations\",\"scope\":[\"source.elixir punctuation.definition.string\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Elixir\",\"scope\":[\"source.elixir variable.other.readwrite.module.elixir\",\"source.elixir variable.other.readwrite.module.elixir punctuation.definition.variable.elixir\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Elixir Binary Punctuations\",\"scope\":[\"source.elixir .punctuation.binary.elixir\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Closure Constant Keyword\",\"scope\":[\"constant.keyword.clojure\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Go Function Calls\",\"scope\":[\"source.go meta.function-call.go\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Go Keywords\",\"scope\":[\"source.go keyword.package.go\",\"source.go keyword.import.go\",\"source.go keyword.function.go\",\"source.go keyword.type.go\",\"source.go keyword.struct.go\",\"source.go keyword.interface.go\",\"source.go keyword.const.go\",\"source.go keyword.var.go\",\"source.go keyword.map.go\",\"source.go keyword.channel.go\",\"source.go keyword.control.go\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"Go Constants e.g. nil, string format (%s, %d, etc.)\",\"scope\":[\"source.go constant.language.go\",\"source.go constant.other.placeholder.go\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"C++ Functions\",\"scope\":[\"entity.name.function.preprocessor.cpp\",\"entity.scope.name.cpp\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"C++ Meta Namespace\",\"scope\":[\"meta.namespace-block.cpp\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"C++ Language Primitive Storage\",\"scope\":[\"storage.type.language.primitive.cpp\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"C++ Preprocessor Macro\",\"scope\":[\"meta.preprocessor.macro.cpp\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"C++ Variable Parameter\",\"scope\":[\"variable.parameter\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Powershell Variables\",\"scope\":[\"variable.other.readwrite.powershell\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Powershell Function\",\"scope\":[\"support.function.powershell\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"ID Attribute Name in HTML\",\"scope\":[\"entity.other.attribute-name.id.html\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"HTML Punctuation Definition Tag\",\"scope\":[\"punctuation.definition.tag.html\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"HTML Doctype\",\"scope\":[\"meta.tag.sgml.doctype.html\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"JavaScript Classes\",\"scope\":[\"meta.class entity.name.type.class.js\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"JavaScript Method Declaration e.g. `constructor`\",\"scope\":[\"meta.method.declaration storage.type.js\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"JavaScript Terminator\",\"scope\":[\"terminator.js\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"JavaScript Meta Punctuation Definition\",\"scope\":[\"meta.js punctuation.definition.js\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Entity Names in Code Documentations\",\"scope\":[\"entity.name.type.instance.jsdoc\",\"entity.name.type.instance.phpdoc\"],\"settings\":{\"foreground\":\"#4d667b\"}},{\"name\":\"Other Variables in Code Documentations\",\"scope\":[\"variable.other.jsdoc\",\"variable.other.phpdoc\"],\"settings\":{\"foreground\":\"#3e697c\"}},{\"name\":\"JavaScript module imports and exports\",\"scope\":[\"variable.other.meta.import.js\",\"meta.import.js variable.other\",\"variable.other.meta.export.js\",\"meta.export.js variable.other\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"JavaScript Variable Parameter Function\",\"scope\":[\"variable.parameter.function.js\"],\"settings\":{\"foreground\":\"#555ea2\"}},{\"name\":\"JavaScript[React] Variable Other Object\",\"scope\":[\"variable.other.object.js\",\"variable.other.object.jsx\",\"variable.object.property.js\",\"variable.object.property.jsx\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"JavaScript Variables\",\"scope\":[\"variable.js\",\"variable.other.js\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"JavaScript Entity Name Type\",\"scope\":[\"entity.name.type.js\",\"entity.name.type.module.js\"],\"settings\":{\"foreground\":\"#111111\",\"fontStyle\":\"\"}},{\"name\":\"JavaScript Support Classes\",\"scope\":[\"support.class.js\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"JSON Property Names\",\"scope\":[\"support.type.property-name.json\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"JSON Support Constants\",\"scope\":[\"support.constant.json\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"JSON Property values (string)\",\"scope\":[\"meta.structure.dictionary.value.json string.quoted.double\"],\"settings\":{\"foreground\":\"#7c5686\"}},{\"name\":\"Strings in JSON values\",\"scope\":[\"string.quoted.double.json punctuation.definition.string.json\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Specific JSON Property values like null\",\"scope\":[\"meta.structure.dictionary.json meta.structure.dictionary.value constant.language\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"JavaScript Other Variable\",\"scope\":[\"variable.other.object.js\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Ruby Variables\",\"scope\":[\"variable.other.ruby\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Ruby Class\",\"scope\":[\"entity.name.type.class.ruby\"],\"settings\":{\"foreground\":\"#984e4d\"}},{\"name\":\"Ruby Hashkeys\",\"scope\":[\"constant.language.symbol.hashkey.ruby\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Ruby Symbols\",\"scope\":[\"constant.language.symbol.ruby\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"LESS Tag names\",\"scope\":[\"entity.name.tag.less\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"LESS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.css\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Attribute Name for LESS\",\"scope\":[\"meta.attribute-selector.less entity.other.attribute-name.attribute\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Markdown Headings\",\"scope\":[\"markup.heading.markdown\",\"markup.heading.setext.1.markdown\",\"markup.heading.setext.2.markdown\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Markdown Italics\",\"scope\":[\"markup.italic.markdown\"],\"settings\":{\"foreground\":\"#8844ae\",\"fontStyle\":\"italic\"}},{\"name\":\"Markdown Bold\",\"scope\":[\"markup.bold.markdown\"],\"settings\":{\"foreground\":\"#3b61b0\",\"fontStyle\":\"bold\"}},{\"name\":\"Markdown Quote + others\",\"scope\":[\"markup.quote.markdown\"],\"settings\":{\"foreground\":\"#5c6285\"}},{\"name\":\"Markdown Raw Code + others\",\"scope\":[\"markup.inline.raw.markdown\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Markdown Links\",\"scope\":[\"markup.underline.link.markdown\",\"markup.underline.link.image.markdown\"],\"settings\":{\"foreground\":\"#954f5a\",\"fontStyle\":\"underline\"}},{\"name\":\"Markdown Link Title and Description\",\"scope\":[\"string.other.link.title.markdown\",\"string.other.link.description.markdown\"],\"settings\":{\"foreground\":\"#403f53\",\"fontStyle\":\"underline\"}},{\"name\":\"Markdown Punctuation\",\"scope\":[\"punctuation.definition.string.markdown\",\"punctuation.definition.string.begin.markdown\",\"punctuation.definition.string.end.markdown\",\"meta.link.inline.markdown punctuation.definition.string\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Markdown MetaData Punctuation\",\"scope\":[\"punctuation.definition.metadata.markdown\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Markdown List Punctuation\",\"scope\":[\"beginning.punctuation.definition.list.markdown\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Markdown Inline Raw String\",\"scope\":[\"markup.inline.raw.string.markdown\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"PHP Variables\",\"scope\":[\"variable.other.php\",\"variable.other.property.php\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Support Classes in PHP\",\"scope\":[\"support.class.php\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Punctuations in PHP function calls\",\"scope\":[\"meta.function-call.php punctuation\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"PHP Global Variables\",\"scope\":[\"variable.other.global.php\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Declaration Punctuation in PHP Global Variables\",\"scope\":[\"variable.other.global.php punctuation.definition.variable\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Language Constants in Python\",\"scope\":[\"constant.language.python\"],\"settings\":{\"foreground\":\"#a24848\"}},{\"name\":\"Python Function Parameter and Arguments\",\"scope\":[\"variable.parameter.function.python\",\"meta.function-call.arguments.python\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Python Function Call\",\"scope\":[\"meta.function-call.python\",\"meta.function-call.generic.python\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"Punctuations in Python\",\"scope\":[\"punctuation.python\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Decorator Functions in Python\",\"scope\":[\"entity.name.function.decorator.python\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Python Language Variable\",\"scope\":[\"source.python variable.language.special\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Python import control keyword\",\"scope\":[\"keyword.control\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"SCSS Variable\",\"scope\":[\"variable.scss\",\"variable.sass\",\"variable.parameter.url.scss\",\"variable.parameter.url.sass\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Variables in SASS At-Rules\",\"scope\":[\"source.css.scss meta.at-rule variable\",\"source.css.sass meta.at-rule variable\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"Variables in SASS At-Rules\",\"scope\":[\"source.css.scss meta.at-rule variable\",\"source.css.sass meta.at-rule variable\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"Attribute Name for SASS\",\"scope\":[\"meta.attribute-selector.scss entity.other.attribute-name.attribute\",\"meta.attribute-selector.sass entity.other.attribute-name.attribute\"],\"settings\":{\"foreground\":\"#aa0982\"}},{\"name\":\"Tag names in SASS\",\"scope\":[\"entity.name.tag.scss\",\"entity.name.tag.sass\"],\"settings\":{\"foreground\":\"#096e72\"}},{\"name\":\"SASS Keyword Other Unit\",\"scope\":[\"keyword.other.unit.scss\",\"keyword.other.unit.sass\"],\"settings\":{\"foreground\":\"#8844ae\"}},{\"name\":\"TypeScript[React] Variables and Object Properties\",\"scope\":[\"variable.other.readwrite.alias.ts\",\"variable.other.readwrite.alias.tsx\",\"variable.other.readwrite.ts\",\"variable.other.readwrite.tsx\",\"variable.other.object.ts\",\"variable.other.object.tsx\",\"variable.object.property.ts\",\"variable.object.property.tsx\",\"variable.other.ts\",\"variable.other.tsx\",\"variable.tsx\",\"variable.ts\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"TypeScript[React] Entity Name Types\",\"scope\":[\"entity.name.type.ts\",\"entity.name.type.tsx\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"TypeScript[React] Node Classes\",\"scope\":[\"support.class.node.ts\",\"support.class.node.tsx\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"TypeScript[React] Entity Name Types as Parameters\",\"scope\":[\"meta.type.parameters.ts entity.name.type\",\"meta.type.parameters.tsx entity.name.type\"],\"settings\":{\"foreground\":\"#4d667b\"}},{\"name\":\"TypeScript[React] Import/Export Punctuations\",\"scope\":[\"meta.import.ts punctuation.definition.block\",\"meta.import.tsx punctuation.definition.block\",\"meta.export.ts punctuation.definition.block\",\"meta.export.tsx punctuation.definition.block\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"TypeScript[React] Punctuation Decorators\",\"scope\":[\"meta.decorator punctuation.decorator.ts\",\"meta.decorator punctuation.decorator.tsx\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"TypeScript[React] Punctuation Decorators\",\"scope\":[\"meta.tag.js meta.jsx.children.tsx\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"YAML Entity Name Tags\",\"scope\":[\"entity.name.tag.yaml\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"JavaScript Variable Other ReadWrite\",\"scope\":[\"variable.other.readwrite.js\",\"variable.parameter\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"Support Class Component\",\"scope\":[\"support.class.component.js\",\"support.class.component.tsx\"],\"settings\":{\"foreground\":\"#aa0982\",\"fontStyle\":\"\"}},{\"name\":\"Text nested in React tags\",\"scope\":[\"meta.jsx.children\",\"meta.jsx.children.js\",\"meta.jsx.children.tsx\"],\"settings\":{\"foreground\":\"#403f53\"}},{\"name\":\"TypeScript Classes\",\"scope\":[\"meta.class entity.name.type.class.tsx\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"TypeScript Entity Name Type\",\"scope\":[\"entity.name.type.tsx\",\"entity.name.type.module.tsx\"],\"settings\":{\"foreground\":\"#111111\"}},{\"name\":\"TypeScript Class Variable Keyword\",\"scope\":[\"meta.class.ts meta.var.expr.ts storage.type.ts\",\"meta.class.tsx meta.var.expr.tsx storage.type.tsx\"],\"settings\":{\"foreground\":\"#76578b\"}},{\"name\":\"TypeScript Method Declaration e.g. `constructor`\",\"scope\":[\"meta.method.declaration storage.type.ts\",\"meta.method.declaration storage.type.tsx\"],\"settings\":{\"foreground\":\"#3b61b0\"}},{\"name\":\"normalize font style of certain components\",\"scope\":[\"meta.property-list.css meta.property-value.css variable.other.less\",\"meta.property-list.scss variable.scss\",\"meta.property-list.sass variable.sass\",\"meta.brace\",\"keyword.operator.operator\",\"keyword.operator.or.regexp\",\"keyword.operator.expression.in\",\"keyword.operator.relational\",\"keyword.operator.assignment\",\"keyword.operator.comparison\",\"keyword.operator.type\",\"keyword.operator\",\"keyword\",\"punctuation.definintion.string\",\"punctuation\",\"variable.other.readwrite.js\",\"storage.type\",\"source.css\",\"string.quoted\"],\"settings\":{\"fontStyle\":\"\"}}],\"styleOverrides\":{\"frames\":{\"editorBackground\":\"var(--sl-color-gray-7)\",\"terminalBackground\":\"var(--sl-color-gray-7)\",\"editorActiveTabBackground\":\"var(--sl-color-gray-7)\",\"terminalTitlebarDotsForeground\":\"color-mix(in srgb, var(--sl-color-gray-5), transparent 25%)\",\"terminalTitlebarDotsOpacity\":\"0.75\",\"inlineButtonForeground\":\"var(--sl-color-text)\",\"frameBoxShadowCssValue\":\"none\"},\"textMarkers\":{\"markBackground\":\"#0000001a\",\"markBorderColor\":\"#00000055\"}}}],\"defaultLocale\":\"zh-CN\",\"styleOverrides\":{\"borderRadius\":\"0px\",\"borderWidth\":\"1px\",\"codePaddingBlock\":\"0.75rem\",\"codePaddingInline\":\"1rem\",\"codeFontFamily\":\"var(--__sl-font-mono)\",\"codeFontSize\":\"var(--sl-text-code)\",\"codeLineHeight\":\"var(--sl-line-height)\",\"uiFontFamily\":\"var(--__sl-font)\",\"textMarkers\":{\"lineDiffIndicatorMarginLeft\":\"0.25rem\",\"defaultChroma\":\"45\",\"backgroundOpacity\":\"60%\"}},\"plugins\":[{\"name\":\"Starlight Plugin\",\"hooks\":{}},{\"name\":\"astro-expressive-code\",\"hooks\":{}}]}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[],\"actionBodySizeLimit\":1048576},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false},\"prefetch\":{\"prefetchAll\":true},\"i18n\":{\"defaultLocale\":\"zh-CN\",\"locales\":[\"zh-CN\"],\"routing\":{\"prefixDefaultLocale\":false,\"redirectToDefaultLocale\":false,\"fallbackType\":\"redirect\"}}}","docs",["Map",11,12,26,27,38,39,82,83,130,131,175,176,202,203,247,248,289,290,328,329,378,379],"index",{"id":11,"data":13,"body":22,"filePath":23,"digest":24,"legacyId":25,"deferredRender":16},{"title":14,"description":15,"editUrl":16,"head":17,"template":18,"sidebar":19,"pagefind":16,"draft":20},""," AI Transformer",true,[],"doc",{"hidden":20,"attrs":21},false,{},"import { Card, CardGrid, Badge } from '@astrojs/starlight/components';\n\n#  AI \n\n****\" Transformer\"\" Transformer\"\n\n## \n\n- ****\n- ****\n- ****      \n\n---\n\n## \n\n###  \u003CBadge text=\"15\" variant=\"tip\" />\n\n\u003CCardGrid stagger>\n  \u003CCard title=\"\" icon=\"open-book\" href=\"/prerequisites\">\n    \n  \u003C/Card>\n\u003C/CardGrid>\n\n### Transformer  \u003CBadge text=\"2\" variant=\"note\" />\n\n\u003CCardGrid stagger>\n  \u003CCard title=\"2.1 Token & Embedding\" icon=\"puzzle\" href=\"/chapter2/1-token-embedding\">\n    \n  \u003C/Card>\n  \u003CCard title=\"2.2 Self-Attention\" icon=\"gear\" href=\"/chapter2/2-self-attention\">\n    \"\"\n  \u003C/Card>\n  \u003CCard title=\"2.3 Multi-Head Attention\" icon=\"gears\" href=\"/chapter2/3-multi-head-attention\">\n    \n  \u003C/Card>\n  \u003CCard title=\"2.4 Positional Encoding\" icon=\"clock\" href=\"/chapter2/4-positional-encoding\">\n    \n  \u003C/Card>\n  \u003CCard title=\"2.5  & LayerNorm\" icon=\"layers\" href=\"/chapter2/5-residual-layernorm\">\n    \n  \u003C/Card>\n  \u003CCard title=\"2.6 FFN & \" icon=\"right-arrow\" href=\"/chapter2/6-ffn-output\">\n    \n  \u003C/Card>\n\u003C/CardGrid>\n\n###  \u003CBadge text=\"1\" variant=\"caution\" />\n\n\u003CCardGrid stagger>\n  \u003CCard title=\"\" icon=\"flask\" href=\"/lab/intro\">\n     Mini Transformer Lab\n  \u003C/Card>\n  \u003CCard title=\"\" icon=\"code\" href=\"/lab/implementation\">\n    \n  \u003C/Card>\n  \u003CCard title=\"\" icon=\"play\" href=\"/lab/training\">\n    \n  \u003C/Card>\n\u003C/CardGrid>\n\n---\n\n## \n\n\n\n1.   Transformer \"\"\n2.   attention \n3.   Transformer \n\n---\n\n## \n\n1. ****\n2. ****\n3. ****Lab \n4. **** loss  30%+ 20+  token\n\n---\n\n[ ](/prerequisites)","src/content/docs/index.mdx","58ce4fb6b38aeae4","index.mdx","prerequisites",{"id":26,"data":28,"body":34,"filePath":35,"digest":36,"legacyId":37,"deferredRender":16},{"title":29,"description":30,"editUrl":16,"head":31,"template":18,"sidebar":32,"pagefind":16,"draft":20},"","10 ",[],{"hidden":20,"attrs":33},{},"# \n\n Transformer \n\n---\n\n## 1. \n\n### \n\n****\n\n```\nv = [1, 2, 3, 4]  #  4 \n```\n\n****\"\" AI \"\"\n\n### \n\n****\n\n```\nM = [[1, 2],\n     [3, 4],\n     [5, 6]]    # 32 \n```\n\n****\"\"\n\n---\n\n## 2. Dot Product\n\n**\"\"**\n\n```\na  b = ab + ab + ... + ab\n\n\n[1, 2, 3]  [4, 5, 6] = 14 + 25 + 36 = 32\n```\n\n### \n\n  \"\"  ** Attention **\n\n```\n Q   K \n   \"\"\"\"\n     \" V\"\n```\n\n---\n\n## 3. \n\n**\"\"**\n\n```\n  [1]  [2]  ...  [N]  \n```\n\n### \n\n|  |  |\n|-----|-----|\n| **** |  |\n| **** |  |\n| **** |  ReLUGELU |\n\n### \n\n1. ****    \n2. ****\n3. ****\"\"\n4. ****\n\n---\n\n## 4. Softmax\n\n****\n\n```\nsoftmax(x) = e^x /  e^x\n\n\n: [2, 1, 0.1]\n: [0.659, 0.242, 0.099]  #  1\n```\n\n###  Softmax\n\n-  0-1   \"\"\n-  1  \"\"\n- **Attention  Softmax **\n\n---\n\n## 5. \n\n\n\n###  1\n `[1, 0]`  `[0, 1]` \n\n:::details[]\n0 0\"\"\n:::\n\n###  2\nSoftmax `[1, 1, 1]` \n\n:::details[]\n`[0.333, 0.333, 0.333]`\n:::\n\n###  3\n\n\n:::details[]\n\n:::\n\n---\n\n## \n\n Transformer \n\n[ 2.1 Token & Embedding ](/chapter2/1-token-embedding)\n\n---\n\n:::tip[]\n****\n:::","src/content/docs/prerequisites.mdx","a69e2742ed4452e8","prerequisites.mdx","chapter2/1-token-embedding",{"id":38,"data":40,"body":46,"filePath":47,"digest":48,"rendered":49,"legacyId":81},{"title":41,"description":42,"editUrl":16,"head":43,"template":18,"sidebar":44,"pagefind":16,"draft":20},"Token  Embedding","",[],{"hidden":20,"attrs":45},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.1 Token  Embedding\n\n Transformer \n1. **Tokenization** token\n2. **Embedding** token \n\n##  Token\n\n\u003CTerminologyCard term=\"Token\" definition=\"\" example=\"'hello world'  ['hello', ' world']  token\" />\n\n### Tokenizer \n\n tokenizer \n\n|  |  |  |\n|------|------|------|\n| Word-level | ['hello', 'world'] |  |\n| Character-level | ['h','e','l','l','o'] |  |\n| Subword (BPE) | ['hel', 'lo', 'world'] |  |\n\n LLM  **BPE (Byte Pair Encoding)**  **SentencePiece**\n\n##  Embedding\n\n\u003CTerminologyCard term=\"Embedding\" definition=\" token \" example=\"token 'hello'  [0.1, -0.3, 0.7, ...] (d_model )\" />\n\n### Embedding \n\n\"\"\n- \n- \"\"`king - man + woman  queen`\n\n### \n\n $V$  embedding  $d$\n\n```\nEmbedding : E  ^(V  d)\n\n i  token  embedding: e_i = E[i]\n```\n\n## \n\n```python\nimport torch.nn as nn\n\nclass TokenEmbedding(nn.Module):\n    def __init__(self, vocab_size: int, d_model: int):\n        super().__init__()\n        # token id  \n        self.embedding = nn.Embedding(vocab_size, d_model)\n\n    def forward(self, x):\n        # x: [batch_size, seq_len] (token ids)\n        # return: [batch_size, seq_len, d_model]\n        return self.embedding(x)\n```\n\n## \n\n- **Token** \n- **Embedding**  token \n- \n\n---\n\n[Self-Attention ](/chapter2/2-self-attention)","src/content/docs/chapter2/1-token-embedding.md","22b13ac6378be949",{"html":50,"metadata":51},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"21-token--embedding\">2.1 Token  Embedding\u003C/h1>\n\u003Cp> Transformer \u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Tokenization\u003C/strong> token\u003C/li>\n\u003Cli>\u003Cstrong>Embedding\u003C/strong> token \u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"-token\"> Token\u003C/h2>\n\u003Cterminologycard term=\"Token\" definition=\"\" example=\"&#x27;hello world&#x27;  [&#x27;hello&#x27;, &#x27; world&#x27;]  token\">\n\u003Ch3 id=\"tokenizer-\">Tokenizer \u003C/h3>\n\u003Cp> tokenizer \u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Word-level\u003C/td>\u003Ctd>[hello, world]\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Character-level\u003C/td>\u003Ctd>[h,e,l,l,o]\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Subword (BPE)\u003C/td>\u003Ctd>[hel, lo, world]\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp> LLM  \u003Cstrong>BPE (Byte Pair Encoding)\u003C/strong>  \u003Cstrong>SentencePiece\u003C/strong>\u003C/p>\n\u003Ch2 id=\"-embedding\"> Embedding\u003C/h2>\n\u003Cterminologycard term=\"Embedding\" definition=\" token \" example=\"token &#x27;hello&#x27;  [0.1, -0.3, 0.7, ...] (d_model )\">\n\u003Ch3 id=\"embedding-\">Embedding \u003C/h3>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003C/li>\n\u003Cli>\u003Ccode dir=\"auto\">king - man + woman  queen\u003C/code>\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp> $V$  embedding  $d$\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Embedding : E  ^(V  d)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\"> i  token  embedding: e_i = E[i]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Embedding : E  ^(V  d) i  token  embedding: e_i = E[i]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">TokenEmbedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># token id  \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.embedding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># x: [batch_size, seq_len] (token ids)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># return: [batch_size, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torch.nn as nnclass TokenEmbedding(nn.Module):    def __init__(self, vocab_size: int, d_model: int):        super().__init__()        # token id          self.embedding = nn.Embedding(vocab_size, d_model)    def forward(self, x):        # x: [batch_size, seq_len] (token ids)        # return: [batch_size, seq_len, d_model]        return self.embedding(x)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Token\u003C/strong> \u003C/li>\n\u003Cli>\u003Cstrong>Embedding\u003C/strong>  token \u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp>\u003Ca href=\"/chapter2/2-self-attention\">Self-Attention \u003C/a>\u003C/p>\u003C/terminologycard>\u003C/terminologycard>",{"headings":52,"localImagePaths":77,"remoteImagePaths":78,"frontmatter":79,"imagePaths":80},[53,57,61,65,68,71,73,75],{"depth":54,"slug":55,"text":56},1,"21-token--embedding","2.1 Token  Embedding",{"depth":58,"slug":59,"text":60},2,"-token"," Token",{"depth":62,"slug":63,"text":64},3,"tokenizer-","Tokenizer ",{"depth":58,"slug":66,"text":67},"-embedding"," Embedding",{"depth":62,"slug":69,"text":70},"embedding-","Embedding ",{"depth":62,"slug":72,"text":72},"",{"depth":58,"slug":74,"text":74},"",{"depth":58,"slug":76,"text":76},"",[],[],{"title":41,"description":42},[],"chapter2/1-token-embedding.md","chapter2/2-self-attention",{"id":82,"data":84,"body":90,"filePath":91,"digest":92,"rendered":93,"legacyId":129},{"title":85,"description":86,"editUrl":16,"head":87,"template":18,"sidebar":88,"pagefind":16,"draft":20},"Self-Attention","",[],{"hidden":20,"attrs":89},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.2 Self-Attention\n\nSelf-Attention  Transformer ****\n\n## \n\n\u003CTerminologyCard term=\"Self-Attention\" definition=\"\" />\n\n\"The **bank** of the river\"\n-  \"bank\"  \"river\"\n- Self-Attention \"\"\n\n## QKV\n\n\u003CTerminologyCard term=\"Query (Q)\" definition=\" token \" />\n\u003CTerminologyCard term=\"Key (K)\" definition=\" token \" />\n\u003CTerminologyCard term=\"Value (V)\" definition=\" token \" />\n\n### \n\n\n- **Query**\" AI \"\n- **Key**/\n- **Value**\n\nQ  K \"\"\n\n## \n\n### Step 1:  QKV\n\n```\nQ = X @ W_Q    # X  embedding\nK = X @ W_K\nV = X @ W_V\n```\n\n### Step 2: \n\n```\nscores = Q @ K^T / d_k\n```\n\n d_k softmax \n\n### Step 3: Softmax \n\n```\nattention_weights = softmax(scores)\n```\n\n### Step 4: \n\n```\noutput = attention_weights @ V\n```\n\n## \n\n$$\\text{Attention}(Q, K, V) = \\text{softmax}\\left(\\frac{QK^T}{\\sqrt{d_k}}\\right) V$$\n\n## \n\n```python\nimport torch\nimport torch.nn as nn\nimport math\n\nclass SelfAttention(nn.Module):\n    def __init__(self, d_model: int):\n        super().__init__()\n        self.d_k = d_model\n\n        # QKV \n        self.W_q = nn.Linear(d_model, d_model)\n        self.W_k = nn.Linear(d_model, d_model)\n        self.W_v = nn.Linear(d_model, d_model)\n\n    def forward(self, x):\n        # x: [batch, seq_len, d_model]\n\n        Q = self.W_q(x)  # [batch, seq_len, d_model]\n        K = self.W_k(x)\n        V = self.W_v(x)\n\n        # \n        scores = torch.matmul(Q, K.transpose(-2, -1)) / math.sqrt(self.d_k)\n\n        # Softmax\n        attention_weights = torch.softmax(scores, dim=-1)\n\n        # \n        output = torch.matmul(attention_weights, V)\n\n        return output, attention_weights\n```\n\n## \n\n- Self-Attention  token \"\" token\n-  QKV \n-  token \n\n---\n\n[Multi-Head Attention ](/chapter2/3-multi-head-attention)","src/content/docs/chapter2/2-self-attention.md","256a31c3d5ca2a3a",{"html":94,"metadata":95},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"22-self-attention\">2.2 Self-Attention\u003C/h1>\n\u003Cp>Self-Attention  Transformer \u003Cstrong>\u003C/strong>\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cterminologycard term=\"Self-Attention\" definition=\"\">\n\u003Cp>The \u003Cstrong>bank\u003C/strong> of the river\u003C/p>\n\u003Cul>\n\u003Cli> bank  river\u003C/li>\n\u003Cli>Self-Attention \u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"qkv\">QKV\u003C/h2>\n\u003Cterminologycard term=\"Query (Q)\" definition=\" token \">\n\u003Cterminologycard term=\"Key (K)\" definition=\" token \">\n\u003Cterminologycard term=\"Value (V)\" definition=\" token \">\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Query\u003C/strong> AI \u003C/li>\n\u003Cli>\u003Cstrong>Key\u003C/strong>/\u003C/li>\n\u003Cli>\u003Cstrong>Value\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Cp>Q  K \u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Ch3 id=\"step-1--qkv\">Step 1:  QKV\u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Q = X @ W_Q    # X  embedding\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">K = X @ W_K\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">V = X @ W_V\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Q = X @ W_Q    # X  embeddingK = X @ W_KV = X @ W_V\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"step-2-\">Step 2: \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">scores = Q @ K^T / d_k\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"scores = Q @ K^T / d_k\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp> d_k softmax \u003C/p>\n\u003Ch3 id=\"step-3-softmax-\">Step 3: Softmax \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">attention_weights = softmax(scores)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"attention_weights = softmax(scores)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"step-4-\">Step 4: \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">output = attention_weights @ V\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"output = attention_weights @ V\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cp>$$\\text{Attention}(Q, K, V) = \\text{softmax}\\left(\\frac{QK^T}{\\sqrt{d_k}}\\right) V$$\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">SelfAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># QKV \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_v \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># x: [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">Q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_q\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">K \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">V \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_v\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">Q\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> K.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)) \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">sqrt\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Softmax\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">attention_weights \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">scores\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">output \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">attention_weights\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> V\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> output, attention_weights\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport torch.nn as nnimport mathclass SelfAttention(nn.Module):    def __init__(self, d_model: int):        super().__init__()        self.d_k = d_model        # QKV         self.W_q = nn.Linear(d_model, d_model)        self.W_k = nn.Linear(d_model, d_model)        self.W_v = nn.Linear(d_model, d_model)    def forward(self, x):        # x: [batch, seq_len, d_model]        Q = self.W_q(x)  # [batch, seq_len, d_model]        K = self.W_k(x)        V = self.W_v(x)        #         scores = torch.matmul(Q, K.transpose(-2, -1)) / math.sqrt(self.d_k)        # Softmax        attention_weights = torch.softmax(scores, dim=-1)        #         output = torch.matmul(attention_weights, V)        return output, attention_weights\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>Self-Attention  token  token\u003C/li>\n\u003Cli> QKV \u003C/li>\n\u003Cli> token \u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp>\u003Ca href=\"/chapter2/3-multi-head-attention\">Multi-Head Attention \u003C/a>\u003C/p>\u003C/terminologycard>\u003C/terminologycard>\u003C/terminologycard>\u003C/terminologycard>",{"headings":96,"localImagePaths":125,"remoteImagePaths":126,"frontmatter":127,"imagePaths":128},[97,100,102,105,107,109,112,115,118,121,123,124],{"depth":54,"slug":98,"text":99},"22-self-attention","2.2 Self-Attention",{"depth":58,"slug":101,"text":101},"",{"depth":58,"slug":103,"text":104},"qkv","QKV",{"depth":62,"slug":106,"text":106},"",{"depth":58,"slug":108,"text":108},"",{"depth":62,"slug":110,"text":111},"step-1--qkv","Step 1:  QKV",{"depth":62,"slug":113,"text":114},"step-2-","Step 2: ",{"depth":62,"slug":116,"text":117},"step-3-softmax-","Step 3: Softmax ",{"depth":62,"slug":119,"text":120},"step-4-","Step 4: ",{"depth":58,"slug":122,"text":122},"",{"depth":58,"slug":74,"text":74},{"depth":58,"slug":76,"text":76},[],[],{"title":85,"description":86},[],"chapter2/2-self-attention.md","chapter2/3-multi-head-attention",{"id":130,"data":132,"body":138,"filePath":139,"digest":140,"rendered":141,"legacyId":174},{"title":133,"description":134,"editUrl":16,"head":135,"template":18,"sidebar":136,"pagefind":16,"draft":20},"Multi-Head Attention","",[],{"hidden":20,"attrs":137},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.3 Multi-Head Attention\n\n****\"\"\n\n## \n\n\u003CTerminologyCard term=\"Multi-Head Attention\" definition=\" attention\" />\n\n attention \n-  1-\n-  2\n-  3\n\n\n\n## \n\n### Step 1: \n\n d_model  h  d_k = d_model / h\n\n```\nQ, K, V: [batch, seq_len, d_model]\n  h \nQ_i, K_i, V_i: [batch, seq_len, d_k]\n```\n\n### Step 2:  head  attention\n\n```\nhead_i = Attention(Q_i, K_i, V_i)\n```\n\n### Step 3:  head\n\n```\nconcat = [head_1, head_2, ..., head_h]  # [batch, seq_len, d_model]\n```\n\n### Step 4: \n\n```\noutput = concat @ W_O\n```\n\n## \n\n$$\\text{MultiHead}(Q, K, V) = \\text{Concat}(\\text{head}_1, ..., \\text{head}_h) W^O$$\n\n\n$$\\text{head}_i = \\text{Attention}(QW_i^Q, KW_i^K, VW_i^V)$$\n\n## \n\n```python\nimport torch\nimport torch.nn as nn\nimport math\n\nclass MultiHeadAttention(nn.Module):\n    def __init__(self, d_model: int, num_heads: int):\n        super().__init__()\n        assert d_model % num_heads == 0\n\n        self.d_model = d_model\n        self.num_heads = num_heads\n        self.d_k = d_model // num_heads\n\n        # QKV  head\n        self.W_q = nn.Linear(d_model, d_model)\n        self.W_k = nn.Linear(d_model, d_model)\n        self.W_v = nn.Linear(d_model, d_model)\n\n        # \n        self.W_o = nn.Linear(d_model, d_model)\n\n    def forward(self, x, mask=None):\n        batch_size, seq_len, _ = x.shape\n\n        # 1. \n        Q = self.W_q(x)  # [batch, seq_len, d_model]\n        K = self.W_k(x)\n        V = self.W_v(x)\n\n        # 2. \n        Q = Q.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)\n        K = K.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)\n        V = V.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)\n        # : [batch, num_heads, seq_len, d_k]\n\n        # 3.  attention\n        scores = torch.matmul(Q, K.transpose(-2, -1)) / math.sqrt(self.d_k)\n        if mask is not None:\n            scores = scores.masked_fill(mask == 0, float('-inf'))\n        attention_weights = torch.softmax(scores, dim=-1)\n        heads = torch.matmul(attention_weights, V)\n\n        # 4.  head\n        concat = heads.transpose(1, 2).contiguous().view(batch_size, seq_len, self.d_model)\n\n        # 5. \n        output = self.W_o(concat)\n\n        return output, attention_weights\n```\n\n## \n\n|  | d_model | num_heads | d_k |\n|------|---------|-----------|-----|\n| BERT-Base | 768 | 12 | 64 |\n| GPT-2 | 768 | 12 | 64 |\n| LLaMA-7B | 4096 | 32 | 128 |\n\n## \n\n-  =  attention \n-  head \n- \n\n---\n\n[Positional Encoding ](/chapter2/4-positional-encoding)","src/content/docs/chapter2/3-multi-head-attention.md","5bec4eca976f90b2",{"html":142,"metadata":143},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"23-multi-head-attention\">2.3 Multi-Head Attention\u003C/h1>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cterminologycard term=\"Multi-Head Attention\" definition=\" attention\">\n\u003Cp> attention \u003C/p>\n\u003Cul>\n\u003Cli> 1-\u003C/li>\n\u003Cli> 2\u003C/li>\n\u003Cli> 3\u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Ch3 id=\"step-1-\">Step 1: \u003C/h3>\n\u003Cp> d_model  h  d_k = d_model / h\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Q, K, V: [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">  h \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Q_i, K_i, V_i: [batch, seq_len, d_k]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Q, K, V: [batch, seq_len, d_model]  h Q_i, K_i, V_i: [batch, seq_len, d_k]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"step-2--head--attention\">Step 2:  head  attention\u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">head_i = Attention(Q_i, K_i, V_i)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"head_i = Attention(Q_i, K_i, V_i)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"step-3--head\">Step 3:  head\u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">concat = [head_1, head_2, ..., head_h]  # [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"concat = [head_1, head_2, ..., head_h]  # [batch, seq_len, d_model]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"step-4-\">Step 4: \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">output = concat @ W_O\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"output = concat @ W_O\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cp>$$\\text{MultiHead}(Q, K, V) = \\text{Concat}(\\text{head}_1, , \\text{head}_h) W^O$$\u003C/p>\n\u003Cp>\n$$\\text{head}_i = \\text{Attention}(QW_i^Q, KW_i^K, VW_i^V)$$\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">MultiHeadAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">assert\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">%\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">==\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.num_heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">//\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># QKV  head\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_v \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_o \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">batch_size, seq_len, _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x.shape\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 1. \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">Q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_q\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">K \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">V \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_v\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 2. \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">Q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> Q.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">batch_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> seq_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">K \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> K.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">batch_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> seq_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">V \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> V.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">batch_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> seq_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># : [batch, num_heads, seq_len, d_k]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 3.  attention\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">Q\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> K.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)) \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">sqrt\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">if\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">is\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">not\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> scores.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">masked_fill\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">==\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--1:#3B61B0\">\u003Cspan style=\"--0:#82AAFF\"> \u003C/span>\u003Cspan style=\"--0:#C5E478\">float\u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">-inf\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">attention_weights \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">scores\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">attention_weights\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> V\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 4.  head\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">concat \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> heads.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">contiguous\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">batch_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> seq_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 5. \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">output \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_o\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">concat\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> output, attention_weights\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport torch.nn as nnimport mathclass MultiHeadAttention(nn.Module):    def __init__(self, d_model: int, num_heads: int):        super().__init__()        assert d_model % num_heads == 0        self.d_model = d_model        self.num_heads = num_heads        self.d_k = d_model // num_heads        # QKV  head        self.W_q = nn.Linear(d_model, d_model)        self.W_k = nn.Linear(d_model, d_model)        self.W_v = nn.Linear(d_model, d_model)        #         self.W_o = nn.Linear(d_model, d_model)    def forward(self, x, mask=None):        batch_size, seq_len, _ = x.shape        # 1.         Q = self.W_q(x)  # [batch, seq_len, d_model]        K = self.W_k(x)        V = self.W_v(x)        # 2.         Q = Q.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)        K = K.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)        V = V.view(batch_size, seq_len, self.num_heads, self.d_k).transpose(1, 2)        # : [batch, num_heads, seq_len, d_k]        # 3.  attention        scores = torch.matmul(Q, K.transpose(-2, -1)) / math.sqrt(self.d_k)        if mask is not None:            scores = scores.masked_fill(mask == 0, float(&#x27;-inf&#x27;))        attention_weights = torch.softmax(scores, dim=-1)        heads = torch.matmul(attention_weights, V)        # 4.  head        concat = heads.transpose(1, 2).contiguous().view(batch_size, seq_len, self.d_model)        # 5.         output = self.W_o(concat)        return output, attention_weights\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>d_model\u003C/th>\u003Cth>num_heads\u003C/th>\u003Cth>d_k\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>BERT-Base\u003C/td>\u003Ctd>768\u003C/td>\u003Ctd>12\u003C/td>\u003Ctd>64\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>GPT-2\u003C/td>\u003Ctd>768\u003C/td>\u003Ctd>12\u003C/td>\u003Ctd>64\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>LLaMA-7B\u003C/td>\u003Ctd>4096\u003C/td>\u003Ctd>32\u003C/td>\u003Ctd>128\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli> =  attention \u003C/li>\n\u003Cli> head \u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp>\u003Ca href=\"/chapter2/4-positional-encoding\">Positional Encoding \u003C/a>\u003C/p>\u003C/terminologycard>",{"headings":144,"localImagePaths":170,"remoteImagePaths":171,"frontmatter":172,"imagePaths":173},[145,148,151,153,156,159,162,165,166,167,169],{"depth":54,"slug":146,"text":147},"23-multi-head-attention","2.3 Multi-Head Attention",{"depth":58,"slug":149,"text":150},"","",{"depth":58,"slug":152,"text":152},"",{"depth":62,"slug":154,"text":155},"step-1-","Step 1: ",{"depth":62,"slug":157,"text":158},"step-2--head--attention","Step 2:  head  attention",{"depth":62,"slug":160,"text":161},"step-3--head","Step 3:  head",{"depth":62,"slug":163,"text":164},"step-4-","Step 4: ",{"depth":58,"slug":122,"text":122},{"depth":58,"slug":74,"text":74},{"depth":58,"slug":168,"text":168},"",{"depth":58,"slug":76,"text":76},[],[],{"title":133,"description":134},[],"chapter2/3-multi-head-attention.md","lab/intro",{"id":175,"data":177,"body":183,"filePath":184,"digest":185,"rendered":186,"legacyId":201},{"title":178,"description":179,"editUrl":16,"head":180,"template":18,"sidebar":181,"pagefind":16,"draft":20},"","Mini Transformer Lab ",[],{"hidden":20,"attrs":182},{},"# Mini Transformer Lab\n\n Mini Transformer Lab Transformer\n\n## \n\n1.  Transformer \n2.  toy \n3. \n\n## \n\n- **** Embedding \n- **** loss \n- **** prompt \n\n[ ](/lab/implementation)","src/content/docs/lab/intro.md","9802d5613c1ca77b",{"html":187,"metadata":188},"\u003Ch1 id=\"mini-transformer-lab\">Mini Transformer Lab\u003C/h1>\n\u003Cp> Mini Transformer Lab Transformer\u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Col>\n\u003Cli> Transformer \u003C/li>\n\u003Cli> toy \u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>\u003C/strong> Embedding \u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong> loss \u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong> prompt \u003C/li>\n\u003C/ul>\n\u003Cp>\u003Ca href=\"/lab/implementation\"> \u003C/a>\u003C/p>",{"headings":189,"localImagePaths":197,"remoteImagePaths":198,"frontmatter":199,"imagePaths":200},[190,193,195],{"depth":54,"slug":191,"text":192},"mini-transformer-lab","Mini Transformer Lab",{"depth":58,"slug":194,"text":194},"",{"depth":58,"slug":196,"text":196},"",[],[],{"title":178,"description":179},[],"lab/intro.md","chapter2/5-residual-layernorm",{"id":202,"data":204,"body":210,"filePath":211,"digest":212,"rendered":213,"legacyId":246},{"title":205,"description":206,"editUrl":16,"head":207,"template":18,"sidebar":208,"pagefind":16,"draft":20}," LayerNorm","",[],{"hidden":20,"attrs":209},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.5  LayerNorm\n\n Transformer ****\n\n## Residual Connection\n\n\u003CTerminologyCard term=\"\" definition=\"output = x + sublayer(x)\" />\n\n### \n\n****\n\n\"\"\n```\n x  sublayer\n```\n\n### Transformer \n\n\n```\nx = x + MultiHeadAttention(x)\nx = x + FFN(x)\n```\n\n## Layer Normalization\n\n\u003CTerminologyCard term=\"LayerNorm\" definition=\" 0 1\" />\n\n### \n\n$$\\text{LN}(x) = \\frac{x - \\mu}{\\sigma} \\cdot \\gamma + \\beta$$\n\n\n- \n- \n- \n\n###  LayerNorm  BatchNorm\n\n| | BatchNorm | LayerNorm |\n|---|-----------|-----------|\n|  |  batch |  |\n|  batch size  |  |  |\n|  |  |  |\n|  |  |  |\n\n### Transformer \n\n TransformerPost-LN\n```\nx = LayerNorm(x + Sublayer(x))\n```\n\nPre-LN\n```\nx = x + Sublayer(LayerNorm(x))\n```\n\n## \n\n```python\nimport torch\nimport torch.nn as nn\n\nclass TransformerBlock(nn.Module):\n    def __init__(self, d_model: int, num_heads: int, d_ff: int, dropout: float = 0.1):\n        super().__init__()\n\n        # Multi-Head Attention\n        self.attention = MultiHeadAttention(d_model, num_heads)\n        self.norm1 = nn.LayerNorm(d_model)\n        self.dropout1 = nn.Dropout(dropout)\n\n        # FFN\n        self.ffn = nn.Sequential(\n            nn.Linear(d_model, d_ff),\n            nn.GELU(),\n            nn.Linear(d_ff, d_model)\n        )\n        self.norm2 = nn.LayerNorm(d_model)\n        self.dropout2 = nn.Dropout(dropout)\n\n    def forward(self, x, mask=None):\n        # Pre-LN \n        # 1. Attention \n        attn_output, _ = self.attention(self.norm1(x), mask)\n        x = x + self.dropout1(attn_output)\n\n        # 2. FFN \n        ffn_output = self.ffn(self.norm2(x))\n        x = x + self.dropout2(ffn_output)\n\n        return x\n```\n\n## \n\n- ****\n- **LayerNorm**\n- **Pre-LN**\n\n---\n\n[FFN  ](/chapter2/6-ffn-output)","src/content/docs/chapter2/5-residual-layernorm.md","6cee10439ae585f5",{"html":214,"metadata":215},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"25--layernorm\">2.5  LayerNorm\u003C/h1>\n\u003Cp> Transformer \u003Cstrong>\u003C/strong>\u003C/p>\n\u003Ch2 id=\"residual-connection\">Residual Connection\u003C/h2>\n\u003Cterminologycard term=\"\" definition=\"output = x + sublayer(x)\">\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cp>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\"> x  sublayer\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\" x  sublayer\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"transformer-\">Transformer \u003C/h3>\n\u003Cp>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">x = x + MultiHeadAttention(x)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">x = x + FFN(x)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"x = x + MultiHeadAttention(x)x = x + FFN(x)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"layer-normalization\">Layer Normalization\u003C/h2>\n\u003Cterminologycard term=\"LayerNorm\" definition=\" 0 1\">\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>$$\\text{LN}(x) = \\frac{x - \\mu}{\\sigma} \\cdot \\gamma + \\beta$$\u003C/p>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>\u003C/li>\n\u003Cli>\u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"-layernorm--batchnorm\"> LayerNorm  BatchNorm\u003C/h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>BatchNorm\u003C/th>\u003Cth>LayerNorm\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003C/td>\u003Ctd> batch\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd> batch size \u003C/td>\u003Ctd>\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003C/td>\u003Ctd>\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003C/td>\u003Ctd>\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"transformer-\">Transformer \u003C/h3>\n\u003Cp> TransformerPost-LN\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">x = LayerNorm(x + Sublayer(x))\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"x = LayerNorm(x + Sublayer(x))\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Pre-LN\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">x = x + Sublayer(LayerNorm(x))\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"x = x + Sublayer(LayerNorm(x))\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">TransformerBlock\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">float\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Multi-Head Attention\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.attention \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">MultiHeadAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm1 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.dropout1 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># FFN\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.ffn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Sequential\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">GELU\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_ff\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm2 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.dropout2 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Pre-LN \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 1. Attention \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">attn_output, _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">attention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> mask\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">dropout1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">attn_output\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># 2. FFN \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">ffn_output \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">ffn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">dropout2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">ffn_output\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport torch.nn as nnclass TransformerBlock(nn.Module):    def __init__(self, d_model: int, num_heads: int, d_ff: int, dropout: float = 0.1):        super().__init__()        # Multi-Head Attention        self.attention = MultiHeadAttention(d_model, num_heads)        self.norm1 = nn.LayerNorm(d_model)        self.dropout1 = nn.Dropout(dropout)        # FFN        self.ffn = nn.Sequential(            nn.Linear(d_model, d_ff),            nn.GELU(),            nn.Linear(d_ff, d_model)        )        self.norm2 = nn.LayerNorm(d_model)        self.dropout2 = nn.Dropout(dropout)    def forward(self, x, mask=None):        # Pre-LN         # 1. Attention         attn_output, _ = self.attention(self.norm1(x), mask)        x = x + self.dropout1(attn_output)        # 2. FFN         ffn_output = self.ffn(self.norm2(x))        x = x + self.dropout2(ffn_output)        return x\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>\u003C/strong>\u003C/li>\n\u003Cli>\u003Cstrong>LayerNorm\u003C/strong>\u003C/li>\n\u003Cli>\u003Cstrong>Pre-LN\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp>\u003Ca href=\"/chapter2/6-ffn-output\">FFN  \u003C/a>\u003C/p>\u003C/terminologycard>\u003C/terminologycard>",{"headings":216,"localImagePaths":242,"remoteImagePaths":243,"frontmatter":244,"imagePaths":245},[217,220,223,226,229,232,234,237,240,241],{"depth":54,"slug":218,"text":219},"25--layernorm","2.5  LayerNorm",{"depth":58,"slug":221,"text":222},"residual-connection","Residual Connection",{"depth":62,"slug":224,"text":225},"","",{"depth":62,"slug":227,"text":228},"transformer-","Transformer ",{"depth":58,"slug":230,"text":231},"layer-normalization","Layer Normalization",{"depth":62,"slug":233,"text":233},"",{"depth":62,"slug":235,"text":236},"-layernorm--batchnorm"," LayerNorm  BatchNorm",{"depth":62,"slug":238,"text":239},"transformer-","Transformer ",{"depth":58,"slug":74,"text":74},{"depth":58,"slug":76,"text":76},[],[],{"title":205,"description":206},[],"chapter2/5-residual-layernorm.md","chapter2/4-positional-encoding",{"id":247,"data":249,"body":255,"filePath":256,"digest":257,"rendered":258,"legacyId":288},{"title":250,"description":251,"editUrl":16,"head":252,"template":18,"sidebar":253,"pagefind":16,"draft":20},"Positional Encoding","",[],{"hidden":20,"attrs":254},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.4 Positional Encoding\n\n**** Self-Attention \n\n## Self-Attention \n\n\u003CTerminologyCard term=\"\" definition=\"Self-Attention \" />\n\n Self-Attention\n-  [\"A\", \"B\", \"C\"]  [\"C\", \"B\", \"A\"]\n-  token \n\n**** token \n\n## \n\n embedding \n\n```\ninput = token_embedding + positional_encoding\n```\n\n## sin/cos  Transformer\n\n\u003CTerminologyCard term=\"sin/cos \" definition=\"\" />\n\n### \n\n$$PE_{(pos, 2i)} = \\sin\\left(\\frac{pos}{10000^{2i/d}}\\right)$$\n\n$$PE_{(pos, 2i+1)} = \\cos\\left(\\frac{pos}{10000^{2i/d}}\\right)$$\n\n\n- pos\n- i\n- dembedding \n\n### \n\n- \n- i \n- i \n- \n\n###  sin/cos\n\n1. **** [-1, 1] \n2. ****\n3. ****PE(pos+k)  PE(pos) \n\n## \n\n```python\nimport torch\nimport math\n\nclass PositionalEncoding(nn.Module):\n    def __init__(self, d_model: int, max_len: int = 5000):\n        super().__init__()\n\n        # \n        pe = torch.zeros(max_len, d_model)\n        position = torch.arange(0, max_len, dtype=torch.float).unsqueeze(1)\n\n        # \n        div_term = torch.exp(\n            torch.arange(0, d_model, 2).float() * (-math.log(10000.0) / d_model)\n        )\n\n        #  sin cos\n        pe[:, 0::2] = torch.sin(position * div_term)\n        pe[:, 1::2] = torch.cos(position * div_term)\n\n        #  buffer\n        self.register_buffer('pe', pe.unsqueeze(0))\n\n    def forward(self, x):\n        # x: [batch, seq_len, d_model]\n        # \n        return x + self.pe[:, :x.size(1)]\n```\n\n## \n\n|  |  |\n|------|------|\n| Learnable (GPT) |  embedding |\n| RoPE (LLaMA) |  |\n| ALiBi |  |\n\n## \n\n- Self-Attention \n-  embedding\n- sin/cos \n\n---\n\n[ LayerNorm ](/chapter2/5-residual-layernorm)","src/content/docs/chapter2/4-positional-encoding.md","06e142fdacd463d7",{"html":259,"metadata":260},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"24-positional-encoding\">2.4 Positional Encoding\u003C/h1>\n\u003Cp>\u003Cstrong>\u003C/strong> Self-Attention \u003C/p>\n\u003Ch2 id=\"self-attention-\">Self-Attention \u003C/h2>\n\u003Cterminologycard term=\"\" definition=\"Self-Attention \">\n\u003Cp> Self-Attention\u003C/p>\n\u003Cul>\n\u003Cli> [A, B, C]  [C, B, A]\u003C/li>\n\u003Cli> token \u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>\u003C/strong> token \u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cp> embedding \u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">input = token_embedding + positional_encoding\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"input = token_embedding + positional_encoding\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"sincos--transformer\">sin/cos  Transformer\u003C/h2>\n\u003Cterminologycard term=\"sin/cos \" definition=\"\">\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>$$PE_{(pos, 2i)} = \\sin\\left(\\frac{pos}{10000^{2i/d}}\\right)$$\u003C/p>\n\u003Cp>$$PE_{(pos, 2i+1)} = \\cos\\left(\\frac{pos}{10000^{2i/d}}\\right)$$\u003C/p>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>pos\u003C/li>\n\u003Cli>i\u003C/li>\n\u003Cli>dembedding \u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cul>\n\u003Cli>\u003C/li>\n\u003Cli>i \u003C/li>\n\u003Cli>i \u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"-sincos\"> sin/cos\u003C/h3>\n\u003Col>\n\u003Cli>\u003Cstrong>\u003C/strong> [-1, 1] \u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong>\u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong>PE(pos+k)  PE(pos) \u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">PositionalEncoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">max_len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">5000\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">zeros\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">max_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">arange\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> max_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dtype\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">torch.float\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">unsqueeze\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">div_term \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">exp\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">arange\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">float\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> (\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">math.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">log\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10000.0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  sin cos\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe[:, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">::\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">] \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">sin\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> div_term\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe[:, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">::\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">] \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">cos\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> div_term\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  buffer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">register_buffer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">pe\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> pe.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">unsqueeze\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># x: [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.pe[:, :x.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport mathclass PositionalEncoding(nn.Module):    def __init__(self, d_model: int, max_len: int = 5000):        super().__init__()        #         pe = torch.zeros(max_len, d_model)        position = torch.arange(0, max_len, dtype=torch.float).unsqueeze(1)        #         div_term = torch.exp(            torch.arange(0, d_model, 2).float() * (-math.log(10000.0) / d_model)        )        #  sin cos        pe[:, 0::2] = torch.sin(position * div_term)        pe[:, 1::2] = torch.cos(position * div_term)        #  buffer        self.register_buffer(&#x27;pe&#x27;, pe.unsqueeze(0))    def forward(self, x):        # x: [batch, seq_len, d_model]        #         return x + self.pe[:, :x.size(1)]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Learnable (GPT)\u003C/td>\u003Ctd> embedding\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>RoPE (LLaMA)\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>ALiBi\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>Self-Attention \u003C/li>\n\u003Cli> embedding\u003C/li>\n\u003Cli>sin/cos \u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp>\u003Ca href=\"/chapter2/5-residual-layernorm\"> LayerNorm \u003C/a>\u003C/p>\u003C/terminologycard>\u003C/terminologycard>",{"headings":261,"localImagePaths":284,"remoteImagePaths":285,"frontmatter":286,"imagePaths":287},[262,265,268,271,274,275,277,280,281,283],{"depth":54,"slug":263,"text":264},"24-positional-encoding","2.4 Positional Encoding",{"depth":58,"slug":266,"text":267},"self-attention-","Self-Attention ",{"depth":58,"slug":269,"text":270},"","",{"depth":58,"slug":272,"text":273},"sincos--transformer","sin/cos  Transformer",{"depth":62,"slug":233,"text":233},{"depth":62,"slug":276,"text":276},"",{"depth":62,"slug":278,"text":279},"-sincos"," sin/cos",{"depth":58,"slug":74,"text":74},{"depth":58,"slug":282,"text":282},"",{"depth":58,"slug":76,"text":76},[],[],{"title":250,"description":251},[],"chapter2/4-positional-encoding.md","lab/implementation",{"id":289,"data":291,"body":296,"filePath":297,"digest":298,"rendered":299,"legacyId":327},{"title":74,"description":292,"editUrl":16,"head":293,"template":18,"sidebar":294,"pagefind":16,"draft":20}," Mini Transformer",[],{"hidden":20,"attrs":295},{},"# \n\n Mini Transformer  **    ** \n\n## \n\n|  |  |  |\n|---------|---------|------|\n| 2.1 Token/Embedding | TokenEmbedding | `embedding.py` |\n| 2.4  | PositionalEncoding | `positional.py` |\n| 2.2 Self-Attention | SelfAttention | `attention.py` |\n| 2.3 Multi-Head | MultiHeadAttention | `multihead.py` |\n| 2.5 +LayerNorm | TransformerBlock | `transformer.py` |\n| 2.6 FFN+ | MiniTransformer | `transformer.py` |\n\n---\n\n## 1. Token Embedding\n\n**** token ID \n\n```python\n# embedding.py\nimport torch\nimport torch.nn as nn\n\nclass TokenEmbedding(nn.Module):\n    def __init__(self, vocab_size: int, d_model: int):\n        super().__init__()\n        self.d_model = d_model\n        self.embedding = nn.Embedding(vocab_size, d_model)\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        # x: [batch, seq_len] -> [batch, seq_len, d_model]\n        return self.embedding(x) * (self.d_model ** 0.5)\n```\n\n****\n```python\n>>> emb = TokenEmbedding(vocab_size=100, d_model=64)\n>>> x = torch.randint(0, 100, (2, 10))  # batch=2, seq_len=10\n>>> emb(x).shape\ntorch.Size([2, 10, 64])  #  \n```\n\n---\n\n## 2. Positional Encoding\n\n**** sin/cos \n\n```python\n# positional.py\nimport math\n\nclass PositionalEncoding(nn.Module):\n    def __init__(self, d_model: int, max_len: int = 5000):\n        super().__init__()\n        pe = torch.zeros(max_len, d_model)\n        position = torch.arange(0, max_len).unsqueeze(1).float()\n        div_term = torch.exp(torch.arange(0, d_model, 2).float()\n                           * (-math.log(10000.0) / d_model))\n        pe[:, 0::2] = torch.sin(position * div_term)  # \n        pe[:, 1::2] = torch.cos(position * div_term)  # \n        self.register_buffer('pe', pe.unsqueeze(0))\n\n    def forward(self, x: torch.Tensor) -> torch.Tensor:\n        return x + self.pe[:, :x.size(1)]\n```\n\n****\n```python\n>>> pe = PositionalEncoding(d_model=64)\n>>> x = torch.randn(1, 10, 64)\n>>> pe(x).shape\ntorch.Size([1, 10, 64])  #  \n```\n\n---\n\n## 3. Self-Attention\n\n****QK  V\n\n```python\n# attention.py\nclass SelfAttention(nn.Module):\n    def __init__(self, d_model: int):\n        super().__init__()\n        self.W_q = nn.Linear(d_model, d_model)\n        self.W_k = nn.Linear(d_model, d_model)\n        self.W_v = nn.Linear(d_model, d_model)\n        self.d_k = d_model\n\n    def forward(self, x, mask=None):\n        Q, K, V = self.W_q(x), self.W_k(x), self.W_v(x)\n        scores = torch.matmul(Q, K.transpose(-2, -1)) / (self.d_k ** 0.5)\n        if mask is not None:\n            scores = scores.masked_fill(mask == 0, float('-inf'))\n        weights = torch.softmax(scores, dim=-1)\n        return torch.matmul(weights, V), weights\n```\n\n****\n```python\n>>> attn = SelfAttention(d_model=64)\n>>> x = torch.randn(1, 5, 64)\n>>> out, weights = attn(x)\n>>> weights.sum(dim=-1)  #  1\ntensor([[1., 1., 1., 1., 1.]])  # \n```\n\n---\n\n## 4. Multi-Head Attention\n\n**** d_model \n\n```python\n# multihead.py\nclass MultiHeadAttention(nn.Module):\n    def __init__(self, d_model: int, num_heads: int):\n        super().__init__()\n        assert d_model % num_heads == 0\n        self.d_k = d_model // num_heads\n        self.num_heads = num_heads\n        self.W_q = nn.Linear(d_model, d_model)\n        self.W_k = nn.Linear(d_model, d_model)\n        self.W_v = nn.Linear(d_model, d_model)\n        self.W_o = nn.Linear(d_model, d_model)\n\n    def forward(self, x, mask=None):\n        B, S, _ = x.shape\n        Q = self.W_q(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)\n        K = self.W_k(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)\n        V = self.W_v(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)\n        scores = torch.matmul(Q, K.transpose(-2, -1)) / (self.d_k ** 0.5)\n        if mask is not None:\n            scores = scores.masked_fill(mask == 0, float('-inf'))\n        weights = torch.softmax(scores, dim=-1)\n        heads = torch.matmul(weights, V)\n        concat = heads.transpose(1, 2).contiguous().view(B, S, -1)\n        return self.W_o(concat), weights\n```\n\n****\n```python\n>>> mha = MultiHeadAttention(d_model=64, num_heads=4)\n>>> x = torch.randn(2, 10, 64)\n>>> out, _ = mha(x)\n>>> out.shape\ntorch.Size([2, 10, 64])  #  \n```\n\n---\n\n## 5. \n\n Mini Transformer\n\n```python\n# transformer.py\nclass MiniTransformer(nn.Module):\n    def __init__(self, vocab_size, d_model=64, num_heads=4,\n                 num_layers=2, d_ff=256, max_len=128):\n        super().__init__()\n        self.token_embedding = TokenEmbedding(vocab_size, d_model)\n        self.pos_encoding = PositionalEncoding(d_model, max_len)\n        self.blocks = nn.ModuleList([\n            TransformerBlock(d_model, num_heads, d_ff)\n            for _ in range(num_layers)\n        ])\n        self.norm = nn.LayerNorm(d_model)\n        self.output = nn.Linear(d_model, vocab_size)\n\n    def forward(self, x, mask=None):\n        x = self.token_embedding(x)\n        x = self.pos_encoding(x)\n        for block in self.blocks:\n            x = block(x, mask)\n        return self.output(self.norm(x))\n```\n\n---\n\n## \n\n [](/lab/training) ","src/content/docs/lab/implementation.md","d8107ae7239c42b9",{"html":300,"metadata":301},"\u003Ch1 id=\"\">\u003C/h1>\n\u003Cp> Mini Transformer  \u003Cstrong>    \u003C/strong> \u003C/p>\n\u003Ch2 id=\"\">\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>2.1 Token/Embedding\u003C/td>\u003Ctd>TokenEmbedding\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">embedding.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2.4 \u003C/td>\u003Ctd>PositionalEncoding\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">positional.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2.2 Self-Attention\u003C/td>\u003Ctd>SelfAttention\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">attention.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2.3 Multi-Head\u003C/td>\u003Ctd>MultiHeadAttention\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">multihead.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2.5 +LayerNorm\u003C/td>\u003Ctd>TransformerBlock\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">transformer.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2.6 FFN+\u003C/td>\u003Ctd>MiniTransformer\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">transformer.py\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Ch2 id=\"1-token-embedding\">1. Token Embedding\u003C/h2>\n\u003Cp>\u003Cstrong>\u003C/strong> token ID \u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">embedding.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">TokenEmbedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.embedding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: torch.Tensor\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> -> torch.Tensor:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># x: [batch, seq_len] -> [batch, seq_len, d_model]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">) \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> (\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">**\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.5\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport torch.nn as nnclass TokenEmbedding(nn.Module):    def __init__(self, vocab_size: int, d_model: int):        super().__init__()        self.d_model = d_model        self.embedding = nn.Embedding(vocab_size, d_model)    def forward(self, x: torch.Tensor) -> torch.Tensor:        # x: [batch, seq_len] -> [batch, seq_len, d_model]        return self.embedding(x) * (self.d_model ** 0.5)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> emb \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">TokenEmbedding\u003C/span>\u003Cspan style=\"--1:#403F53\">\u003Cspan style=\"--0:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--0:#D7DBE0\">vocab_size\u003C/span>\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">100\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">d_model\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">randint\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">100\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> (\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># batch=2, seq_len=10\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">emb\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).shape\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  \u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> emb = TokenEmbedding(vocab_size=100, d_model=64)>>> x = torch.randint(0, 100, (2, 10))  # batch=2, seq_len=10>>> emb(x).shapetorch.Size([2, 10, 64])  #  \">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"2-positional-encoding\">2. Positional Encoding\u003C/h2>\n\u003Cp>\u003Cstrong>\u003C/strong> sin/cos \u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">positional.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> math\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">PositionalEncoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">max_len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">5000\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">zeros\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">max_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">arange\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> max_len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">unsqueeze\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">float\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">div_term \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">exp\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">arange\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">float\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                           \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> (\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">math.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">log\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10000.0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe[:, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">::\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">] \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">sin\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> div_term\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">pe[:, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">::\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">] \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">cos\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">position \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">*\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> div_term\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">register_buffer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">pe\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> pe.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">unsqueeze\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: torch.Tensor\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> -> torch.Tensor:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.pe[:, :x.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import mathclass PositionalEncoding(nn.Module):    def __init__(self, d_model: int, max_len: int = 5000):        super().__init__()        pe = torch.zeros(max_len, d_model)        position = torch.arange(0, max_len).unsqueeze(1).float()        div_term = torch.exp(torch.arange(0, d_model, 2).float()                           * (-math.log(10000.0) / d_model))        pe[:, 0::2] = torch.sin(position * div_term)  #         pe[:, 1::2] = torch.cos(position * div_term)  #         self.register_buffer(&#x27;pe&#x27;, pe.unsqueeze(0))    def forward(self, x: torch.Tensor) -> torch.Tensor:        return x + self.pe[:, :x.size(1)]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> pe \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">PositionalEncoding\u003C/span>\u003Cspan style=\"--1:#403F53\">\u003Cspan style=\"--0:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--0:#D7DBE0\">d_model\u003C/span>\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">randn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">pe\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).shape\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  \u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> pe = PositionalEncoding(d_model=64)>>> x = torch.randn(1, 10, 64)>>> pe(x).shapetorch.Size([1, 10, 64])  #  \">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"3-self-attention\">3. Self-Attention\u003C/h2>\n\u003Cp>\u003Cstrong>\u003C/strong>QK  V\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">attention.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">SelfAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_v \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">Q, K, V \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_q\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">), \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">), \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_v\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">Q\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> K.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)) \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> (\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">**\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.5\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">if\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">is\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">not\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> scores.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">masked_fill\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">==\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--1:#3B61B0\">\u003Cspan style=\"--0:#82AAFF\"> \u003C/span>\u003Cspan style=\"--0:#C5E478\">float\u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">-inf\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">weights \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">scores\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">weights\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> V\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">), weights\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class SelfAttention(nn.Module):    def __init__(self, d_model: int):        super().__init__()        self.W_q = nn.Linear(d_model, d_model)        self.W_k = nn.Linear(d_model, d_model)        self.W_v = nn.Linear(d_model, d_model)        self.d_k = d_model    def forward(self, x, mask=None):        Q, K, V = self.W_q(x), self.W_k(x), self.W_v(x)        scores = torch.matmul(Q, K.transpose(-2, -1)) / (self.d_k ** 0.5)        if mask is not None:            scores = scores.masked_fill(mask == 0, float(&#x27;-inf&#x27;))        weights = torch.softmax(scores, dim=-1)        return torch.matmul(weights, V), weights\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> attn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">SelfAttention\u003C/span>\u003Cspan style=\"--1:#403F53\">\u003Cspan style=\"--0:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--0:#D7DBE0\">d_model\u003C/span>\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">randn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">5\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> out, weights \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">attn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> weights.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">sum\u003C/span>\u003Cspan style=\"--1:#403F53\">\u003Cspan style=\"--0:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--0:#D7DBE0\">dim\u003C/span>\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  1\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">tensor\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[[\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">., \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">., \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">., \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">., \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> attn = SelfAttention(d_model=64)>>> x = torch.randn(1, 5, 64)>>> out, weights = attn(x)>>> weights.sum(dim=-1)  #  1tensor([[1., 1., 1., 1., 1.]])  # \">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"4-multi-head-attention\">4. Multi-Head Attention\u003C/h2>\n\u003Cp>\u003Cstrong>\u003C/strong> d_model \u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">multihead.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">MultiHeadAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">int\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">assert\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">%\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">==\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> d_model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">//\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.num_heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> num_heads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_v \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.W_o \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">B, S, _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x.shape\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">Q \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_q\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">B\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> S\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">K \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">B\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> S\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">V \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_v\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">B\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> S\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.d_k\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">Q\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> K.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)) \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> (\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.d_k \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">**\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.5\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">if\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">is\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">not\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">scores \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> scores.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">masked_fill\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">mask \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">==\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--1:#3B61B0\">\u003Cspan style=\"--0:#82AAFF\"> \u003C/span>\u003Cspan style=\"--0:#C5E478\">float\u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">-inf\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">weights \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">scores\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">heads \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">matmul\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">weights\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> V\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">concat \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> heads.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">transpose\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">contiguous\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">B\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> S\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">W_o\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">concat\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">), weights\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class MultiHeadAttention(nn.Module):    def __init__(self, d_model: int, num_heads: int):        super().__init__()        assert d_model % num_heads == 0        self.d_k = d_model // num_heads        self.num_heads = num_heads        self.W_q = nn.Linear(d_model, d_model)        self.W_k = nn.Linear(d_model, d_model)        self.W_v = nn.Linear(d_model, d_model)        self.W_o = nn.Linear(d_model, d_model)    def forward(self, x, mask=None):        B, S, _ = x.shape        Q = self.W_q(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)        K = self.W_k(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)        V = self.W_v(x).view(B, S, self.num_heads, self.d_k).transpose(1, 2)        scores = torch.matmul(Q, K.transpose(-2, -1)) / (self.d_k ** 0.5)        if mask is not None:            scores = scores.masked_fill(mask == 0, float(&#x27;-inf&#x27;))        weights = torch.softmax(scores, dim=-1)        heads = torch.matmul(weights, V)        concat = heads.transpose(1, 2).contiguous().view(B, S, -1)        return self.W_o(concat), weights\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> mha \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">MultiHeadAttention\u003C/span>\u003Cspan style=\"--1:#403F53\">\u003Cspan style=\"--0:#D6DEEB\">(\u003C/span>\u003Cspan style=\"--0:#D7DBE0\">d_model\u003C/span>\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">num_heads\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">4\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">randn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> out, _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">mha\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> out.shape\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">10\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">, \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  \u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> mha = MultiHeadAttention(d_model=64, num_heads=4)>>> x = torch.randn(2, 10, 64)>>> out, _ = mha(x)>>> out.shapetorch.Size([2, 10, 64])  #  \">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"5-\">5. \u003C/h2>\n\u003Cp> Mini Transformer\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">transformer.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">MiniTransformer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">4\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                 \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_layers=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_ff=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">256\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">max_len=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">128\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.token_embedding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">TokenEmbedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.pos_encoding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">PositionalEncoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> max_len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.blocks \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">ModuleList\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">TransformerBlock\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--1:#3B61B0\">\u003Cspan style=\"--0:#82AAFF\"> \u003C/span>\u003Cspan style=\"--0:#C5E478\">range\u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">num_layers\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.output \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">token_embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">pos_encoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> block \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.blocks:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">block\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> mask\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">output\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class MiniTransformer(nn.Module):    def __init__(self, vocab_size, d_model=64, num_heads=4,                 num_layers=2, d_ff=256, max_len=128):        super().__init__()        self.token_embedding = TokenEmbedding(vocab_size, d_model)        self.pos_encoding = PositionalEncoding(d_model, max_len)        self.blocks = nn.ModuleList([            TransformerBlock(d_model, num_heads, d_ff)            for _ in range(num_layers)        ])        self.norm = nn.LayerNorm(d_model)        self.output = nn.Linear(d_model, vocab_size)    def forward(self, x, mask=None):        x = self.token_embedding(x)        x = self.pos_encoding(x)        for block in self.blocks:            x = block(x, mask)        return self.output(self.norm(x))\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cp> \u003Ca href=\"/lab/training\">\u003C/a> \u003C/p>",{"headings":302,"localImagePaths":323,"remoteImagePaths":324,"frontmatter":325,"imagePaths":326},[303,304,306,309,312,315,318,321],{"depth":54,"slug":74,"text":74},{"depth":58,"slug":305,"text":305},"",{"depth":58,"slug":307,"text":308},"1-token-embedding","1. Token Embedding",{"depth":58,"slug":310,"text":311},"2-positional-encoding","2. Positional Encoding",{"depth":58,"slug":313,"text":314},"3-self-attention","3. Self-Attention",{"depth":58,"slug":316,"text":317},"4-multi-head-attention","4. Multi-Head Attention",{"depth":58,"slug":319,"text":320},"5-","5. ",{"depth":58,"slug":322,"text":322},"",[],[],{"title":74,"description":292},[],"lab/implementation.md","chapter2/6-ffn-output",{"id":328,"data":330,"body":336,"filePath":337,"digest":338,"rendered":339,"legacyId":377},{"title":331,"description":332,"editUrl":16,"head":333,"template":18,"sidebar":334,"pagefind":16,"draft":20},"FFN ","",[],{"hidden":20,"attrs":335},{},"import TerminologyCard from '@components/common/TerminologyCard.astro';\n\n# 2.6 FFN \n\nFFN Transformer ****\n\n## Feed-Forward Network (FFN)\n\n\u003CTerminologyCard term=\"FFN\" definition=\"\" />\n\n### \n\n```\nFFN(x) = GELU(xW + b)W + b\n```\n\n\n- W: d_model  d_ff d_ff = 4  d_model\n- W: d_ff  d_model\n\n###  FFN\n\nSelf-Attention ****FFN ****\n- Attention token \n- FFN token \n\n\n- Attention = \n- FFN = \n\n### \n\n|  |  |\n|----------|----------|\n| ReLU |  Transformer |\n| GELU | BERT, GPT, LLaMA |\n| Swish/GLU | PaLM, LLaMA 2 |\n\n## \n\n Transformer Block  hidden state \n\n### Logits \n\n```python\nlogits = hidden @ W_vocab  # [batch, seq_len, vocab_size]\n```\n\n### Softmax \n\n```python\nprobs = softmax(logits, dim=-1)  # [batch, seq_len, vocab_size]\n```\n\n### \n\n\n1. ****W_vocab = Embedding^T\n2. ****\n\n##  Transformer Block\n\n```python\nclass TransformerBlock(nn.Module):\n    def __init__(self, d_model, num_heads, d_ff, dropout=0.1):\n        super().__init__()\n        self.attention = MultiHeadAttention(d_model, num_heads)\n        self.norm1 = nn.LayerNorm(d_model)\n        self.ffn = nn.Sequential(\n            nn.Linear(d_model, d_ff),\n            nn.GELU(),\n            nn.Dropout(dropout),\n            nn.Linear(d_ff, d_model),\n            nn.Dropout(dropout)\n        )\n        self.norm2 = nn.LayerNorm(d_model)\n\n    def forward(self, x, mask=None):\n        # Pre-LN Attention\n        x = x + self.attention(self.norm1(x), mask)\n        # Pre-LN FFN\n        x = x + self.ffn(self.norm2(x))\n        return x\n```\n\n##  Transformer \n\n```python\nclass Transformer(nn.Module):\n    def __init__(self, vocab_size, d_model, num_heads, num_layers, d_ff, max_len=512):\n        super().__init__()\n\n        # Embedding + Positional Encoding\n        self.token_embedding = nn.Embedding(vocab_size, d_model)\n        self.pos_encoding = PositionalEncoding(d_model, max_len)\n\n        # Transformer Blocks\n        self.blocks = nn.ModuleList([\n            TransformerBlock(d_model, num_heads, d_ff)\n            for _ in range(num_layers)\n        ])\n\n        #  LayerNorm\n        self.norm = nn.LayerNorm(d_model)\n\n        # \n        self.output = nn.Linear(d_model, vocab_size, bias=False)\n        self.output.weight = self.token_embedding.weight\n\n    def forward(self, x, mask=None):\n        # Embedding\n        x = self.token_embedding(x)\n        x = self.pos_encoding(x)\n\n        # Transformer Blocks\n        for block in self.blocks:\n            x = block(x, mask)\n\n        # \n        x = self.norm(x)\n        logits = self.output(x)\n\n        return logits\n```\n\n## \n\n- **FFN** 4 \n- **** hidden state \n- ****\n\n---\n\n ****  Transformer \n\n[ Mini Transformer Lab ](/lab/intro)","src/content/docs/chapter2/6-ffn-output.md","c015908b0a5689fe",{"html":340,"metadata":341},"\u003Cp>import TerminologyCard from @components/common/TerminologyCard.astro;\u003C/p>\n\u003Ch1 id=\"26-ffn-\">2.6 FFN \u003C/h1>\n\u003Cp>FFN Transformer \u003Cstrong>\u003C/strong>\u003C/p>\n\u003Ch2 id=\"feed-forward-network-ffn\">Feed-Forward Network (FFN)\u003C/h2>\n\u003Cterminologycard term=\"FFN\" definition=\"\">\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">FFN(x) = GELU(xW + b)W + b\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"FFN(x) = GELU(xW + b)W + b\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>W: d_model  d_ff d_ff = 4  d_model\u003C/li>\n\u003Cli>W: d_ff  d_model\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"-ffn\"> FFN\u003C/h3>\n\u003Cp>Self-Attention \u003Cstrong>\u003C/strong>FFN \u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Attention token \u003C/li>\n\u003Cli>FFN token \u003C/li>\n\u003C/ul>\n\u003Cp>\u003C/p>\n\u003Cul>\n\u003Cli>Attention = \u003C/li>\n\u003Cli>FFN = \u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"\">\u003C/h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>ReLU\u003C/td>\u003Ctd> Transformer\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>GELU\u003C/td>\u003Ctd>BERT, GPT, LLaMA\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Swish/GLU\u003C/td>\u003Ctd>PaLM, LLaMA 2\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cp> Transformer Block  hidden state \u003C/p>\n\u003Ch3 id=\"logits-\">Logits \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">logits \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> hidden \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">@\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> W_vocab  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># [batch, seq_len, vocab_size]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"logits = hidden @ W_vocab  # [batch, seq_len, vocab_size]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"softmax-\">Softmax \u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">probs \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">logits\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># [batch, seq_len, vocab_size]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"probs = softmax(logits, dim=-1)  # [batch, seq_len, vocab_size]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>\u003C/strong>W_vocab = Embedding^T\u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"-transformer-block\"> Transformer Block\u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">TransformerBlock\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">dropout=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.attention \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">MultiHeadAttention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm1 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.ffn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Sequential\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">GELU\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_ff\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">dropout\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm2 \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Pre-LN Attention\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">attention\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> mask\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Pre-LN FFN\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">+\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">ffn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class TransformerBlock(nn.Module):    def __init__(self, d_model, num_heads, d_ff, dropout=0.1):        super().__init__()        self.attention = MultiHeadAttention(d_model, num_heads)        self.norm1 = nn.LayerNorm(d_model)        self.ffn = nn.Sequential(            nn.Linear(d_model, d_ff),            nn.GELU(),            nn.Dropout(dropout),            nn.Linear(d_ff, d_model),            nn.Dropout(dropout)        )        self.norm2 = nn.LayerNorm(d_model)    def forward(self, x, mask=None):        # Pre-LN Attention        x = x + self.attention(self.norm1(x), mask)        # Pre-LN FFN        x = x + self.ffn(self.norm2(x))        return x\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"-transformer-\"> Transformer \u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">Transformer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">nn\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">Module\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_heads\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">num_layers\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">max_len=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">512\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">super\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">().\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Embedding + Positional Encoding\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.token_embedding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.pos_encoding \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">PositionalEncoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> max_len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Transformer Blocks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.blocks \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">ModuleList\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">TransformerBlock\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> d_ff\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--1:#3B61B0\">\u003Cspan style=\"--0:#82AAFF\"> \u003C/span>\u003Cspan style=\"--0:#C5E478\">range\u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">num_layers\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  LayerNorm\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.norm \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">LayerNorm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.output \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">Linear\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">bias\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">False\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.output.weight \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.token_embedding.weight\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">forward\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">mask=\u003C/span>\u003Cspan style=\"--0:#FF6A83;--1:#A24848\">None\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Embedding\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">token_embedding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">pos_encoding\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># Transformer Blocks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> block \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.blocks:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">block\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> mask\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">x \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">norm\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">logits \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">output\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> logits\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class Transformer(nn.Module):    def __init__(self, vocab_size, d_model, num_heads, num_layers, d_ff, max_len=512):        super().__init__()        # Embedding + Positional Encoding        self.token_embedding = nn.Embedding(vocab_size, d_model)        self.pos_encoding = PositionalEncoding(d_model, max_len)        # Transformer Blocks        self.blocks = nn.ModuleList([            TransformerBlock(d_model, num_heads, d_ff)            for _ in range(num_layers)        ])        #  LayerNorm        self.norm = nn.LayerNorm(d_model)        #         self.output = nn.Linear(d_model, vocab_size, bias=False)        self.output.weight = self.token_embedding.weight    def forward(self, x, mask=None):        # Embedding        x = self.token_embedding(x)        x = self.pos_encoding(x)        # Transformer Blocks        for block in self.blocks:            x = block(x, mask)        #         x = self.norm(x)        logits = self.output(x)        return logits\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>FFN\u003C/strong> 4 \u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong> hidden state \u003C/li>\n\u003Cli>\u003Cstrong>\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Chr>\n\u003Cp> \u003Cstrong>\u003C/strong>  Transformer \u003C/p>\n\u003Cp>\u003Ca href=\"/lab/intro\"> Mini Transformer Lab \u003C/a>\u003C/p>\u003C/terminologycard>",{"headings":342,"localImagePaths":373,"remoteImagePaths":374,"frontmatter":375,"imagePaths":376},[343,346,349,351,354,356,358,361,364,366,369,372],{"depth":54,"slug":344,"text":345},"26-ffn-","2.6 FFN ",{"depth":58,"slug":347,"text":348},"feed-forward-network-ffn","Feed-Forward Network (FFN)",{"depth":62,"slug":350,"text":350},"",{"depth":62,"slug":352,"text":353},"-ffn"," FFN",{"depth":62,"slug":355,"text":355},"",{"depth":58,"slug":357,"text":357},"",{"depth":62,"slug":359,"text":360},"logits-","Logits ",{"depth":62,"slug":362,"text":363},"softmax-","Softmax ",{"depth":62,"slug":365,"text":365},"",{"depth":58,"slug":367,"text":368},"-transformer-block"," Transformer Block",{"depth":58,"slug":370,"text":371},"-transformer-"," Transformer ",{"depth":58,"slug":76,"text":76},[],[],{"title":331,"description":332},[],"chapter2/6-ffn-output.md","lab/training",{"id":378,"data":380,"body":386,"filePath":387,"digest":388,"rendered":389,"legacyId":427},{"title":381,"description":382,"editUrl":16,"head":383,"template":18,"sidebar":384,"pagefind":16,"draft":20},"","Mini Transformer ",[],{"hidden":20,"attrs":385},{},"# \n\n Mini Transformer \n\n---\n\n## 1. \n\n toy \n\n```python\n# data.py\nSHAKESPEARE_TEXT = \"\"\"\nTo be, or not to be, that is the question:\nWhether 'tis nobler in the mind to suffer\nThe slings and arrows of outrageous fortune,\nOr to take arms against a sea of troubles\n...\n\"\"\"\n\nclass CharTokenizer:\n    \"\"\"\"\"\"\n    def __init__(self, text: str):\n        self.chars = sorted(list(set(text)))\n        self.vocab_size = len(self.chars)\n        self.char_to_idx = {c: i for i, c in enumerate(self.chars)}\n        self.idx_to_char = {i: c for i, c in enumerate(self.chars)}\n\n    def encode(self, text): return [self.char_to_idx[c] for c in text]\n    def decode(self, ids): return ''.join([self.idx_to_char[i] for i in ids])\n```\n\n****\n```python\n>>> tokenizer = CharTokenizer(SHAKESPEARE_TEXT)\n>>> tokenizer.vocab_size\n45  # \n>>> tokenizer.decode(tokenizer.encode(\"To be\"))\n'To be'  #  \n```\n\n---\n\n## 2. \n\n```python\nconfig = {\n    'vocab_size': 45,\n    'd_model': 64,\n    'num_heads': 4,\n    'num_layers': 2,\n    'd_ff': 256,\n    'seq_len': 32,\n    'batch_size': 16,\n    'learning_rate': 3e-4,\n    'epochs': 100,\n}\n```\n\n---\n\n## 3. \n\n```python\n# train.py\nimport torch\nimport torch.nn as nn\nfrom torch.utils.data import DataLoader\n\nmodel = MiniTransformer(**config).to(device)\noptimizer = torch.optim.AdamW(model.parameters(), lr=3e-4)\ncriterion = nn.CrossEntropyLoss()\n\nfor epoch in range(epochs):\n    model.train()\n    for x, y in dataloader:\n        logits = model(x)\n        loss = criterion(logits.view(-1, vocab_size), y.view(-1))\n        optimizer.zero_grad()\n        loss.backward()\n        torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)\n        optimizer.step()\n```\n\n---\n\n## 4. \n\n**Loss   30%**\n\n```\nEpoch   1 | Loss: 3.8062 | : 0.0%\nEpoch  10 | Loss: 2.4521 | : 35.6%  \nEpoch  50 | Loss: 1.1234 | : 70.5%\nEpoch 100 | Loss: 0.6789 | : 82.2%\n\n : Loss  30% (: 82.2%)\n```\n\n---\n\n## 5. \n\n### \n\n```python\n# generate.py\ndef generate(model, tokenizer, prompt, max_new_tokens=50, temperature=0.8):\n    model.eval()\n    ids = torch.tensor([tokenizer.encode(prompt)])\n\n    with torch.no_grad():\n        for _ in range(max_new_tokens):\n            logits = model(ids[:, -64:])[:, -1, :] / temperature\n            probs = torch.softmax(logits, dim=-1)\n            next_id = torch.multinomial(probs, 1)\n            ids = torch.cat([ids, next_id], dim=1)\n\n    return tokenizer.decode(ids[0].tolist())\n```\n\n### \n\n** 20  token**\n\n```python\n>>> generate(model, tokenizer, \"To be\", max_new_tokens=30)\n'To be, or not to be, that is the question:'\n```\n\n| Prompt |  Token  |  |\n|--------|----------------|------|\n| \"To be\" | 28 |  |\n| \"Whether\" | 35 |  |\n| \"The \" | 42 |  |\n\n** :  token  20**\n\n---\n\n## 6. Colab \n\n Google Colab \n\n[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/)\n\n### Colab \n\n1.  GPU`!nvidia-smi`\n2. `!pip install torch`\n3. \n4.  2 \n5. \n\n---\n\n## \n\n|  |  |  |  |\n|---------|------|------|------|\n| Loss  | 30% | 82.2% |  |\n|  Token | 20 | 28+ |  |\n\n  Transformer\n\n---\n\n## \n\n- [Chapter 3: ](/chapter3/) -  LLM \n- [Chapter 4: Scaling Law](/chapter4/) - ","src/content/docs/lab/training.md","d12b4fd33a7ace3f",{"html":390,"metadata":391},"\u003Ch1 id=\"\">\u003C/h1>\n\u003Cp> Mini Transformer \u003C/p>\n\u003Chr>\n\u003Ch2 id=\"1-\">1. \u003C/h2>\n\u003Cp> toy \u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.tm3va.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.8zarh.js\">\u003C/script>\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">data.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">SHAKESPEARE_TEXT\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">To be, or not to be, that is the question:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">Whether 'tis nobler in the mind to suffer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">The slings and arrows of outrageous fortune,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">Or to take arms against a sea of troubles\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">class\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#FFCB8B;--1:#111111\">CharTokenizer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\"\"\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">__init__\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">text\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">str\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.chars \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">sorted\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">list\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">set\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">text\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.vocab_size \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">len\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.chars\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.char_to_idx \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> {c: i \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> i, c \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">enumerate\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.chars\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.idx_to_char \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> {i: c \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> i, c \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">enumerate\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.chars\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">encode\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">text\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.char_to_idx[c] \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> c \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> text\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">decode\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">self\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">ids\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">''\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">join\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#8EACE3;--1:#AA0982\">self\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.idx_to_char\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">[\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">i\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">]\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> i \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> ids\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"SHAKESPEARE_TEXT = &#x22;&#x22;&#x22;To be, or not to be, that is the question:Whether &#x27;tis nobler in the mind to sufferThe slings and arrows of outrageous fortune,Or to take arms against a sea of troubles...&#x22;&#x22;&#x22;class CharTokenizer:    &#x22;&#x22;&#x22;&#x22;&#x22;&#x22;    def __init__(self, text: str):        self.chars = sorted(list(set(text)))        self.vocab_size = len(self.chars)        self.char_to_idx = {c: i for i, c in enumerate(self.chars)}        self.idx_to_char = {i: c for i, c in enumerate(self.chars)}    def encode(self, text): return [self.char_to_idx[c] for c in text]    def decode(self, ids): return &#x27;&#x27;.join([self.idx_to_char[i] for i in ids])\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> tokenizer \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">CharTokenizer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">SHAKESPEARE_TEXT\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> tokenizer.vocab_size\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">45\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\"># \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> tokenizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">decode\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">tokenizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">encode\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">To be\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">To be\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">  \u003C/span>\u003Cspan style=\"--0:#919F9F;--1:#5F636F\">#  \u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> tokenizer = CharTokenizer(SHAKESPEARE_TEXT)>>> tokenizer.vocab_size45  # >>> tokenizer.decode(tokenizer.encode(&#x22;To be&#x22;))&#x27;To be&#x27;  #  \">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"2-\">2. \u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">config \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">vocab_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">45\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">d_model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">num_heads\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">4\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">num_layers\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">2\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">d_ff\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">256\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">seq_len\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">32\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">batch_size\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">16\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">learning_rate\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">3e-4\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">epochs\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">: \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">100\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"config = {    &#x27;vocab_size&#x27;: 45,    &#x27;d_model&#x27;: 64,    &#x27;num_heads&#x27;: 4,    &#x27;num_layers&#x27;: 2,    &#x27;d_ff&#x27;: 256,    &#x27;seq_len&#x27;: 32,    &#x27;batch_size&#x27;: 16,    &#x27;learning_rate&#x27;: 3e-4,    &#x27;epochs&#x27;: 100,}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"3-\">3. \u003C/h2>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">train.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.nn \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">as\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">from\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.utils.data \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">import\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> DataLoader\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">model \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">MiniTransformer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">**\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">config\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">).\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">to\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">device\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">optimizer \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.optim.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">AdamW\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">model.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">parameters\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">lr\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">3e-4\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">criterion \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> nn.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">CrossEntropyLoss\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> epoch \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">range\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">epochs\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">model.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">train\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> x, y \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> dataloader:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">logits \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">x\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">loss \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">criterion\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">logits.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> vocab_size\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> y.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">view\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">optimizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">zero_grad\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">loss.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">backward\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">torch.nn.utils.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">clip_grad_norm_\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">model.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">parameters\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1.0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">optimizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">step\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import torchimport torch.nn as nnfrom torch.utils.data import DataLoadermodel = MiniTransformer(**config).to(device)optimizer = torch.optim.AdamW(model.parameters(), lr=3e-4)criterion = nn.CrossEntropyLoss()for epoch in range(epochs):    model.train()    for x, y in dataloader:        logits = model(x)        loss = criterion(logits.view(-1, vocab_size), y.view(-1))        optimizer.zero_grad()        loss.backward()        torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)        optimizer.step()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"4-\">4. \u003C/h2>\n\u003Cp>\u003Cstrong>Loss   30%\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Epoch   1 | Loss: 3.8062 | : 0.0%\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Epoch  10 | Loss: 2.4521 | : 35.6%  \u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Epoch  50 | Loss: 1.1234 | : 70.5%\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\">Epoch 100 | Loss: 0.6789 | : 82.2%\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#d6deeb;--1:#403f53\"> : Loss  30% (: 82.2%)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Epoch   1 | Loss: 3.8062 | : 0.0%Epoch  10 | Loss: 2.4521 | : 35.6%  Epoch  50 | Loss: 1.1234 | : 70.5%Epoch 100 | Loss: 0.6789 | : 82.2% : Loss  30% (: 82.2%)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Ch2 id=\"5-\">5. \u003C/h2>\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">generate.py\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">def\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">generate\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">(\u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">tokenizer\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">prompt\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">max_new_tokens=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">50\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, \u003C/span>\u003Cspan style=\"--0:#7FDBCA;--1:#096E72\">temperature=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0.8\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">)\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">model.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">eval\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">ids \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">tensor\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">tokenizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">encode\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">prompt\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">with\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">no_grad\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">for\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> _ \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">in\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C5E478;--1:#3B61B0\">range\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">max_new_tokens\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">logits \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">model\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">ids\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">[\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">:, \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">64\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">:\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">])\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">:, \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">, :\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">]\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">/\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> temperature\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">probs \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">softmax\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">logits\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=-\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">next_id \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">multinomial\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">probs\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">ids \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> torch.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">cat\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">[\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">ids, next_id\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">],\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">dim\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">1\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">return\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> tokenizer.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">decode\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">ids\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">[\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">0\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">]\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">.\u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">tolist\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">())\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def generate(model, tokenizer, prompt, max_new_tokens=50, temperature=0.8):    model.eval()    ids = torch.tensor([tokenizer.encode(prompt)])    with torch.no_grad():        for _ in range(max_new_tokens):            logits = model(ids[:, -64:])[:, -1, :] / temperature            probs = torch.softmax(logits, dim=-1)            next_id = torch.multinomial(probs, 1)            ids = torch.cat([ids, next_id], dim=1)    return tokenizer.decode(ids[0].tolist())\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Ch3 id=\"\">\u003C/h3>\n\u003Cp>\u003Cstrong> 20  token\u003C/strong>\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">>>>\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\"> \u003C/span>\u003Cspan style=\"--0:#B2CCD6;--1:#096E72\">generate\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">(\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\">model\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> tokenizer\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">To be\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">\"\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">,\u003C/span>\u003Cspan style=\"--0:#82AAFF;--1:#3B61B0\"> \u003C/span>\u003Cspan style=\"--0:#D7DBE0;--1:#403F53\">max_new_tokens\u003C/span>\u003Cspan style=\"--0:#C792EA;--1:#8844AE\">=\u003C/span>\u003Cspan style=\"--0:#F78C6C;--1:#AA0982\">30\u003C/span>\u003Cspan style=\"--0:#D6DEEB;--1:#403F53\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003Cspan style=\"--0:#ECC48D;--1:#984E4D\">To be, or not to be, that is the question:\u003C/span>\u003Cspan style=\"--0:#D9F5DD;--1:#111111\">'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\">>> generate(model, tokenizer, &#x22;To be&#x22;, max_new_tokens=30)&#x27;To be, or not to be, that is the question:&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Prompt\u003C/th>\u003Cth> Token \u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>To be\u003C/td>\u003Ctd>28\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Whether\u003C/td>\u003Ctd>35\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>The \u003C/td>\u003Ctd>42\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong> :  token  20\u003C/strong>\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"6-colab-\">6. Colab \u003C/h2>\n\u003Cp> Google Colab \u003C/p>\n\u003Cp>\u003Ca href=\"https://colab.research.google.com/\">\u003Cimg src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\">\u003C/a>\u003C/p>\n\u003Ch3 id=\"colab-\">Colab \u003C/h3>\n\u003Col>\n\u003Cli> GPU\u003Ccode dir=\"auto\">!nvidia-smi\u003C/code>\u003C/li>\n\u003Cli>\u003Ccode dir=\"auto\">!pip install torch\u003C/code>\u003C/li>\n\u003Cli>\u003C/li>\n\u003Cli> 2 \u003C/li>\n\u003Cli>\u003C/li>\n\u003C/ol>\n\u003Chr>\n\u003Ch2 id=\"\">\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003Cth>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Loss \u003C/td>\u003Ctd>30%\u003C/td>\u003Ctd>82.2%\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd> Token\u003C/td>\u003Ctd>20\u003C/td>\u003Ctd>28+\u003C/td>\u003Ctd>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>  Transformer\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"\">\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Ca href=\"/chapter3/\">Chapter 3: \u003C/a> -  LLM \u003C/li>\n\u003Cli>\u003Ca href=\"/chapter4/\">Chapter 4: Scaling Law\u003C/a> - \u003C/li>\n\u003C/ul>",{"headings":392,"localImagePaths":423,"remoteImagePaths":424,"frontmatter":425,"imagePaths":426},[393,394,397,400,403,406,409,411,413,416,419,421],{"depth":54,"slug":381,"text":381},{"depth":58,"slug":395,"text":396},"1-","1. ",{"depth":58,"slug":398,"text":399},"2-","2. ",{"depth":58,"slug":401,"text":402},"3-","3. ",{"depth":58,"slug":404,"text":405},"4-","4. ",{"depth":58,"slug":407,"text":408},"5-","5. ",{"depth":62,"slug":410,"text":410},"",{"depth":62,"slug":412,"text":412},"",{"depth":58,"slug":414,"text":415},"6-colab-","6. Colab ",{"depth":62,"slug":417,"text":418},"colab-","Colab ",{"depth":58,"slug":420,"text":420},"",{"depth":58,"slug":422,"text":422},"",[],[],{"title":381,"description":382},[],"lab/training.md"]